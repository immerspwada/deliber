<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Test Provider Job Button Fix</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: #f9fafb;
      padding: 20px;
    }

    .container {
      max-width: 600px;
      margin: 0 auto;
    }

    .card {
      background: white;
      border-radius: 16px;
      padding: 24px;
      margin-bottom: 16px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }

    h1 {
      font-size: 24px;
      margin-bottom: 8px;
      color: #111;
    }

    .subtitle {
      color: #6b7280;
      margin-bottom: 24px;
    }

    .test-section {
      margin-bottom: 24px;
    }

    .test-section h2 {
      font-size: 18px;
      margin-bottom: 12px;
      color: #374151;
    }

    .status-test {
      display: flex;
      flex-direction: column;
      gap: 12px;
      padding: 16px;
      background: #f9fafb;
      border-radius: 12px;
      margin-bottom: 12px;
    }

    .status-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 12px;
      background: white;
      border-radius: 8px;
      border: 1px solid #e5e7eb;
    }

    .status-info {
      flex: 1;
    }

    .status-label {
      font-weight: 600;
      color: #111;
      margin-bottom: 4px;
    }

    .status-value {
      font-size: 14px;
      color: #6b7280;
      font-family: monospace;
    }

    .status-result {
      padding: 8px 16px;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 600;
    }

    .status-result.success {
      background: #d1fae5;
      color: #065f46;
    }

    .status-result.error {
      background: #fee2e2;
      color: #991b1b;
    }

    .button-test {
      display: flex;
      gap: 12px;
      margin-top: 16px;
    }

    button {
      flex: 1;
      padding: 16px;
      border: none;
      border-radius: 12px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
    }

    .test-btn {
      background: #3b82f6;
      color: white;
    }

    .test-btn:hover {
      background: #2563eb;
    }

    .test-btn:active {
      transform: scale(0.98);
    }

    .code-block {
      background: #1f2937;
      color: #f3f4f6;
      padding: 16px;
      border-radius: 12px;
      font-family: monospace;
      font-size: 13px;
      overflow-x: auto;
      margin-top: 12px;
    }

    .success-icon {
      color: #10b981;
      font-size: 20px;
    }

    .error-icon {
      color: #ef4444;
      font-size: 20px;
    }

    .info-box {
      background: #eff6ff;
      border: 1px solid #bfdbfe;
      border-radius: 12px;
      padding: 16px;
      margin-top: 16px;
    }

    .info-box h3 {
      color: #1e40af;
      font-size: 16px;
      margin-bottom: 8px;
    }

    .info-box p {
      color: #1e3a8a;
      font-size: 14px;
      line-height: 1.6;
    }

    .info-box ul {
      margin-top: 12px;
      padding-left: 20px;
    }

    .info-box li {
      color: #1e3a8a;
      font-size: 14px;
      margin-bottom: 6px;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="card">
      <h1>üîß Provider Job Button Fix Test</h1>
      <p class="subtitle">‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏õ‡∏∏‡πà‡∏°‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ï‡πà‡∏≠‡πÑ‡∏õ‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤ Provider Job Detail</p>

      <div class="test-section">
        <h2>üìä Status Flow Mapping Test</h2>
        <div id="statusTests"></div>
      </div>

      <div class="test-section">
        <h2>üß™ Test with Job ID</h2>
        <div class="button-test">
          <button class="test-btn" onclick="testJobId()">
            Test Job: 0a723139-0b79-47eb-9065-a2673f8e847a
          </button>
        </div>
        <div id="jobTestResult"></div>
      </div>

      <div class="info-box">
        <h3>‚úÖ ‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</h3>
        <ul>
          <li><strong>‡∏™‡∏£‡πâ‡∏≤‡∏á useJobStatusFlow composable</strong> - ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏´‡∏•‡∏≤‡∏¢ status ‡∏à‡∏≤‡∏Å database</li>
          <li><strong>‡πÄ‡∏û‡∏¥‡πà‡∏° debug logging</strong> - ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• status flow ‡πÉ‡∏ô console</li>
          <li><strong>‡πÄ‡∏û‡∏¥‡πà‡∏° debug panel</strong> - ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• debug ‡πÉ‡∏ô‡πÇ‡∏´‡∏°‡∏î development</li>
          <li><strong>‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç status mapping</strong> - ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö matched, accepted, confirmed</li>
        </ul>
      </div>

      <div class="info-box" style="background: #fef3c7; border-color: #fde68a; margin-top: 16px;">
        <h3 style="color: #92400e;">üîç ‡∏ß‡∏¥‡∏ò‡∏µ‡∏ó‡∏î‡∏™‡∏≠‡∏ö</h3>
        <p style="color: #78350f;">
          1. ‡πÄ‡∏õ‡∏¥‡∏î <code>http://localhost:5173/provider/job/0a723139-0b79-47eb-9065-a2673f8e847a</code><br>
          2. ‡πÄ‡∏õ‡∏¥‡∏î Browser Console (F12)<br>
          3. ‡∏î‡∏π‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• debug ‡∏ó‡∏µ‡πà‡πÅ‡∏™‡∏î‡∏á<br>
          4. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏õ‡∏∏‡πà‡∏° "‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ï‡πà‡∏≠‡πÑ‡∏õ" ‡πÅ‡∏™‡∏î‡∏á‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà<br>
          5. ‡∏ñ‡πâ‡∏≤‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡πÇ‡∏´‡∏°‡∏î development ‡∏à‡∏∞‡πÄ‡∏´‡πá‡∏ô debug panel ‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á
        </p>
      </div>
    </div>
  </div>

  <script>
    // Status flow mapping (same as useJobStatusFlow.ts)
    const STATUS_FLOW = [
      {
        key: 'matched',
        label: '‡∏£‡∏±‡∏ö‡∏á‡∏≤‡∏ô‡πÅ‡∏•‡πâ‡∏ß',
        icon: '‚úÖ',
        action: '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÑ‡∏õ‡∏£‡∏±‡∏ö',
        dbStatus: ['matched', 'accepted', 'confirmed']
      },
      {
        key: 'pickup',
        label: '‡∏ñ‡∏∂‡∏á‡∏à‡∏∏‡∏î‡∏£‡∏±‡∏ö‡πÅ‡∏•‡πâ‡∏ß',
        icon: 'üìç',
        action: '‡∏ñ‡∏∂‡∏á‡∏à‡∏∏‡∏î‡∏£‡∏±‡∏ö‡πÅ‡∏•‡πâ‡∏ß',
        dbStatus: ['pickup', 'arrived', 'arriving', 'at_pickup']
      },
      {
        key: 'in_progress',
        label: '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á',
        icon: 'üõ£Ô∏è',
        action: '‡∏£‡∏±‡∏ö‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡πÅ‡∏•‡πâ‡∏ß',
        dbStatus: ['in_progress', 'picked_up', 'ongoing', 'started']
      },
      {
        key: 'completed',
        label: '‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô',
        icon: 'üéâ',
        action: '‡∏™‡πà‡∏á‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à',
        dbStatus: ['completed', 'finished', 'done']
      }
    ]

    function testStatus(dbStatus) {
      const index = STATUS_FLOW.findIndex(step => 
        step.dbStatus.includes(dbStatus)
      )
      
      if (index === -1) {
        return {
          found: false,
          message: `‚ùå ‡πÑ‡∏°‡πà‡∏û‡∏ö status "${dbStatus}" ‡πÉ‡∏ô flow`
        }
      }

      const currentStep = STATUS_FLOW[index]
      const nextStep = index < STATUS_FLOW.length - 1 ? STATUS_FLOW[index + 1] : null

      return {
        found: true,
        currentStep,
        nextStep,
        canProgress: nextStep !== null,
        message: nextStep 
          ? `‚úÖ ‡∏û‡∏ö status, ‡∏õ‡∏∏‡πà‡∏°‡∏ñ‡∏±‡∏î‡πÑ‡∏õ: "${nextStep.action}"`
          : `‚úÖ ‡∏û‡∏ö status, ‡πÅ‡∏ï‡πà‡πÄ‡∏õ‡πá‡∏ô‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢‡πÅ‡∏•‡πâ‡∏ß`
      }
    }

    function renderStatusTests() {
      const container = document.getElementById('statusTests')
      const testStatuses = [
        'matched', 'accepted', 'confirmed',
        'pickup', 'arrived', 'arriving',
        'in_progress', 'picked_up', 'ongoing',
        'completed', 'finished',
        'unknown_status'
      ]

      container.innerHTML = testStatuses.map(status => {
        const result = testStatus(status)
        const resultClass = result.found ? 'success' : 'error'
        
        return `
          <div class="status-row">
            <div class="status-info">
              <div class="status-label">Database Status: "${status}"</div>
              <div class="status-value">
                ${result.found ? `
                  Current: ${result.currentStep.key} ‚Üí 
                  Next: ${result.nextStep ? result.nextStep.key : 'none'}
                ` : 'Not found in flow'}
              </div>
            </div>
            <div class="status-result ${resultClass}">
              ${result.found ? '‚úÖ OK' : '‚ùå Error'}
            </div>
          </div>
        `
      }).join('')
    }

    function testJobId() {
      const resultDiv = document.getElementById('jobTestResult')
      resultDiv.innerHTML = `
        <div class="code-block">
// Console output example:
[JobDetail] Status Debug: {
  jobStatus: "matched",
  currentIndex: 0,
  currentStep: "matched",
  nextStep: "pickup",
  nextDbStatus: "pickup",
  canProgress: true,
  canUpdateStatus: true,
  updating: false
}

// ‡∏õ‡∏∏‡πà‡∏°‡∏Ñ‡∏ß‡∏£‡πÅ‡∏™‡∏î‡∏á: "‡∏ñ‡∏∂‡∏á‡∏à‡∏∏‡∏î‡∏£‡∏±‡∏ö‡πÅ‡∏•‡πâ‡∏ß"
        </div>
        <div class="info-box" style="margin-top: 16px;">
          <h3>üìù ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö</h3>
          <p>
            1. ‡πÄ‡∏õ‡∏¥‡∏î URL ‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô‡πÉ‡∏ô‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå<br>
            2. Login ‡πÄ‡∏õ‡πá‡∏ô Provider<br>
            3. ‡∏î‡∏π‡∏ß‡πà‡∏≤‡∏õ‡∏∏‡πà‡∏° "‡∏ñ‡∏∂‡∏á‡∏à‡∏∏‡∏î‡∏£‡∏±‡∏ö‡πÅ‡∏•‡πâ‡∏ß" ‡πÅ‡∏™‡∏î‡∏á‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà<br>
            4. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Console log ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π debug info
          </p>
        </div>
      `
    }

    // Run tests on load
    renderStatusTests()
  </script>
</body>
</html>
