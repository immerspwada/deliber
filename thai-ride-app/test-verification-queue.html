<!DOCTYPE html>
<html>
<head>
  <title>Test Verification Queue</title>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
  <h1>Test Verification Queue</h1>
  <button onclick="testQueue()">Test Queue</button>
  <button onclick="testPending()">Test Pending Providers</button>
  <button onclick="createTest()">Create Test Provider</button>
  <pre id="result"></pre>

  <script>
    // ใส่ Supabase credentials ของคุณ
    const SUPABASE_URL = 'YOUR_SUPABASE_URL'
    const SUPABASE_ANON_KEY = 'YOUR_SUPABASE_ANON_KEY'
    
    const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY)
    const output = document.getElementById('result')

    async function testQueue() {
      output.textContent = 'Testing admin_get_verification_queue...\n'
      
      try {
        const { data, error } = await supabase.rpc('admin_get_verification_queue', {
          p_status: 'pending'
        })
        
        if (error) {
          output.textContent += 'ERROR: ' + JSON.stringify(error, null, 2)
        } else {
          output.textContent += 'SUCCESS!\n'
          output.textContent += 'Count: ' + (data?.length || 0) + '\n'
          output.textContent += JSON.stringify(data, null, 2)
        }
      } catch (e) {
        output.textContent += 'EXCEPTION: ' + e.message
      }
    }

    async function testPending() {
      output.textContent = 'Testing admin_get_pending_providers...\n'
      
      try {
        const { data, error } = await supabase.rpc('admin_get_pending_providers')
        
        if (error) {
          output.textContent += 'ERROR: ' + JSON.stringify(error, null, 2)
        } else {
          output.textContent += 'SUCCESS!\n'
          output.textContent += 'Count: ' + (data?.length || 0) + '\n'
          output.textContent += JSON.stringify(data, null, 2)
        }
      } catch (e) {
        output.textContent += 'EXCEPTION: ' + e.message
      }
    }

    async function createTest() {
      output.textContent = 'Creating test provider...\n'
      
      try {
        // Get customer@demo.com user
        const { data: users, error: userError } = await supabase
          .from('users')
          .select('id')
          .eq('email', 'customer@demo.com')
          .limit(1)
        
        if (userError) throw userError
        if (!users || users.length === 0) {
          output.textContent += 'ERROR: customer@demo.com not found'
          return
        }

        // Create provider
        const { data, error } = await supabase
          .from('service_providers')
          .insert({
            user_id: users[0].id,
            provider_type: 'driver',
            status: 'pending'
          })
          .select()
        
        if (error) {
          output.textContent += 'ERROR: ' + JSON.stringify(error, null, 2)
        } else {
          output.textContent += 'SUCCESS! Created provider\n'
          output.textContent += JSON.stringify(data, null, 2)
        }
      } catch (e) {
        output.textContent += 'EXCEPTION: ' + e.message
      }
    }
  </script>
</body>
</html>
