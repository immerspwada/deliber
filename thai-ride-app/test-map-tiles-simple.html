<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Simple Map Tiles Test</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" 
    integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" 
    crossorigin="" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
    integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
    crossorigin=""></script>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { 
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: #f5f5f5;
      padding: 20px;
    }
    .container {
      max-width: 800px;
      margin: 0 auto;
      background: white;
      border-radius: 16px;
      padding: 20px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    h1 {
      font-size: 24px;
      margin-bottom: 16px;
      color: #1a1a1a;
    }
    #map {
      width: 100%;
      height: 400px;
      border-radius: 12px;
      background: #e0e0e0;
      margin-bottom: 20px;
    }
    .info {
      padding: 16px;
      background: #f8f9fa;
      border-radius: 8px;
      font-size: 14px;
      line-height: 1.6;
    }
    .info h2 {
      font-size: 16px;
      margin-bottom: 8px;
      color: #495057;
    }
    .status {
      display: flex;
      gap: 12px;
      margin-top: 12px;
    }
    .status-item {
      padding: 8px 12px;
      background: white;
      border-radius: 6px;
      font-size: 13px;
    }
    .status-item.success { color: #28a745; border-left: 3px solid #28a745; }
    .status-item.error { color: #dc3545; border-left: 3px solid #dc3545; }
    .status-item.warning { color: #ffc107; border-left: 3px solid #ffc107; }
    .log {
      margin-top: 16px;
      padding: 12px;
      background: #1a1a1a;
      color: #00ff00;
      border-radius: 8px;
      font-family: 'Courier New', monospace;
      font-size: 12px;
      max-height: 300px;
      overflow-y: auto;
    }
    .log-entry {
      margin-bottom: 4px;
      word-break: break-all;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>üó∫Ô∏è Simple Map Tiles Test</h1>
    
    <div id="map"></div>
    
    <div class="info">
      <h2>üìä Status</h2>
      <div class="status">
        <div class="status-item" id="status-loading">Loading: <span id="count-loading">0</span></div>
        <div class="status-item success" id="status-loaded">Loaded: <span id="count-loaded">0</span></div>
        <div class="status-item error" id="status-failed">Failed: <span id="count-failed">0</span></div>
      </div>
      
      <div class="log" id="log">
        <div class="log-entry">üìã Initializing...</div>
      </div>
    </div>
  </div>

  <script>
    let tilesLoading = 0;
    let tilesLoaded = 0;
    let tilesFailed = 0;

    function updateStatus() {
      document.getElementById('count-loading').textContent = tilesLoading;
      document.getElementById('count-loaded').textContent = tilesLoaded;
      document.getElementById('count-failed').textContent = tilesFailed;
    }

    function log(message, data = null) {
      const logEl = document.getElementById('log');
      const entry = document.createElement('div');
      entry.className = 'log-entry';
      const time = new Date().toLocaleTimeString();
      entry.textContent = `[${time}] ${message}`;
      if (data) {
        entry.textContent += ` ${JSON.stringify(data)}`;
      }
      logEl.appendChild(entry);
      logEl.scrollTop = logEl.scrollHeight;
      console.log(message, data);
    }

    // Initialize map
    log('üöÄ Creating map instance...');
    const map = L.map('map', {
      center: [13.7563, 100.5018], // Bangkok
      zoom: 13,
      zoomControl: true,
      attributionControl: true
    });
    log('‚úÖ Map instance created');

    // Create tile layer
    log('üì¶ Creating tile layer...');
    const tileLayer = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '¬© OpenStreetMap contributors',
      subdomains: ['a', 'b', 'c'],
      maxZoom: 19,
      minZoom: 1,
      tileSize: 256
    });

    // Track tile events
    tileLayer.on('loading', () => {
      log('üîÑ Tile layer loading started');
      tilesLoading = 0;
      tilesLoaded = 0;
      tilesFailed = 0;
      updateStatus();
    });

    tileLayer.on('tileloadstart', (e) => {
      tilesLoading++;
      updateStatus();
      log('üì• Tile load start', { coords: e.coords });
    });

    tileLayer.on('tileload', (e) => {
      tilesLoading--;
      tilesLoaded++;
      updateStatus();
      log('‚úÖ Tile loaded', { coords: e.coords });
    });

    tileLayer.on('tileerror', (e) => {
      tilesLoading--;
      tilesFailed++;
      updateStatus();
      log('‚ùå Tile error', { 
        coords: e.coords, 
        url: e.tile.src,
        error: e.error 
      });
    });

    tileLayer.on('load', () => {
      log('‚úÖ All tiles loaded!', { 
        loaded: tilesLoaded, 
        failed: tilesFailed 
      });
      
      // Check DOM
      setTimeout(() => {
        const container = map.getContainer();
        const tilePane = container.querySelector('.leaflet-tile-pane');
        const tiles = tilePane?.querySelectorAll('img.leaflet-tile');
        
        log('üîç DOM Check', {
          tile_pane_exists: !!tilePane,
          tile_count: tiles?.length || 0
        });

        if (tilePane) {
          const styles = window.getComputedStyle(tilePane);
          log('üé® Tile Pane Styles', {
            opacity: styles.opacity,
            visibility: styles.visibility,
            display: styles.display,
            zIndex: styles.zIndex
          });
        }

        if (tiles && tiles.length > 0) {
          const firstTile = tiles[0];
          const tileStyles = window.getComputedStyle(firstTile);
          log('üñºÔ∏è First Tile', {
            src: firstTile.src,
            complete: firstTile.complete,
            naturalWidth: firstTile.naturalWidth,
            naturalHeight: firstTile.naturalHeight,
            opacity: tileStyles.opacity,
            visibility: tileStyles.visibility
          });
        } else {
          log('‚ö†Ô∏è No tiles found in DOM!');
        }
      }, 1000);
    });

    // Add to map
    log('üìç Adding tile layer to map...');
    tileLayer.addTo(map);
    log('‚úÖ Tile layer added');

    // Add marker
    const marker = L.marker([13.7563, 100.5018]).addTo(map);
    marker.bindPopup('Bangkok').openPopup();
    log('üìç Marker added');

    // Map click
    map.on('click', (e) => {
      log('üñ±Ô∏è Map clicked', { 
        lat: e.latlng.lat.toFixed(4), 
        lng: e.latlng.lng.toFixed(4) 
      });
    });

    log('‚úÖ Setup complete!');
  </script>
</body>
</html>
