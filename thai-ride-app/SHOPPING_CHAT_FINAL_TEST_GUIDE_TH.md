# ЁЯзк р╕Др╕╣р╣Ир╕бр╕╖р╕нр╕Чр╕Фр╕кр╕нр╕Ъ Shopping Chat (р╕Йр╕Ър╕▒р╕Ър╕кр╕╕р╕Фр╕Чр╣Йр╕▓р╕в)

**р╕зр╕▒р╕Щр╕Чр╕╡р╣И**: 2026-01-27  
**р╕кр╕Цр╕▓р╕Щр╕░**: тЬЕ р╕Юр╕гр╣Йр╕нр╕бр╕Чр╕Фр╕кр╕нр╕Ъ

---

## ЁЯФз р╕кр╕┤р╣Ир╕Зр╕Чр╕╡р╣Ир╣Бр╕Бр╣Йр╣Др╕В

р╣Бр╕Бр╣Йр╣Др╕Вр╕Ыр╕▒р╕Нр╕лр╕▓ **parameter name mismatch** р╕гр╕░р╕лр╕зр╣Ир╕▓р╕З frontend р╣Бр╕ер╕░ database functions:

- тЬЕ `mark_shopping_messages_read` р╣Гр╕Кр╣Й `p_sender_id` р╣Бр╕Чр╕Щ `p_user_id`
- тЬЕ `get_shopping_unread_count` р╣Гр╕Кр╣Й `p_sender_id` р╣Бр╕Чр╕Щ `p_user_id`

---

## ЁЯЪи р╕кр╕│р╕Др╕▒р╕Нр╕бр╕▓р╕Б: р╕Хр╣Йр╕нр╕З Hard Refresh

**р╕Хр╣Йр╕нр╕Зр╕Чр╕│р╕Бр╣Ир╕нр╕Щр╕Чр╕Фр╕кр╕нр╕Ъ** р╣Ар╕Юр╕╖р╣Ир╕нр╕ер╣Йр╕▓р╕З JavaScript cache:

### р╕Др╕нр╕бр╕Юр╕┤р╕зр╣Ар╕Хр╕нр╕гр╣М

- **Windows/Linux**: р╕Бр╕Ф `Ctrl + Shift + R` р╕лр╕гр╕╖р╕н `Ctrl + F5`
- **Mac**: р╕Бр╕Ф `Cmd + Shift + R`

### р╕бр╕╖р╕нр╕Цр╕╖р╕н

- **iPhone (Safari)**: р╕Хр╕▒р╣Йр╕Зр╕Др╣Ир╕▓ тЖТ Safari тЖТ р╕ер╣Йр╕▓р╕Зр╕Ыр╕гр╕░р╕зр╕▒р╕Хр╕┤р╣Бр╕ер╕░р╕Вр╣Йр╕нр╕бр╕╣р╕ер╣Ар╕зр╣Зр╕Ър╣Др╕Лр╕Хр╣М
- **Android (Chrome)**: р╕Хр╕▒р╣Йр╕Зр╕Др╣Ир╕▓ тЖТ р╕Др╕зр╕▓р╕бр╣Ар╕Ыр╣Зр╕Щр╕кр╣Ир╕зр╕Щр╕Хр╕▒р╕з тЖТ р╕ер╣Йр╕▓р╕Зр╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Бр╕▓р╕гр╣Ар╕Вр╣Йр╕▓р╕Кр╕б тЖТ р╕гр╕╣р╕Ыр╕ар╕▓р╕Юр╣Бр╕ер╕░р╣Др╕Яр╕ер╣Мр╕Чр╕╡р╣Ир╣Бр╕Др╕К

---

## ЁЯУ▒ р╕Чр╕Фр╕кр╕нр╕Ър╕Эр╕▒р╣Ир╕Зр╕ер╕╣р╕Бр╕Др╣Йр╕▓ (Customer)

### р╕Вр╕▒р╣Йр╕Щр╕Хр╕нр╕Щ

1. **Hard Refresh** р╕Хр╕▓р╕бр╕Фр╣Йр╕▓р╕Щр╕Ър╕Щ тЪая╕П
2. р╣Ар╕Ыр╕┤р╕Ф: `http://localhost:5173/tracking/SHP-20260127-958060`
3. р╕Бр╕Фр╕Ыр╕╕р╣Ир╕б **"р╕Бр╕▓р╕гр╕кр╕Щр╕Чр╕Щр╕▓"**
4. р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ъ Console (F12):
   - тЬЕ р╣Др╕бр╣Ир╕бр╕╡ error 400 Bad Request
   - тЬЕ р╣Др╕бр╣Ир╕бр╕╡ error 404 Not Found
   - тЬЕ р╣Ар╕лр╣Зр╕Щр╕Вр╣Йр╕нр╕Др╕зр╕▓р╕б `тЬЕ MESSAGES_RPC LOADED` р╕лр╕гр╕╖р╕н `тЬЕ MESSAGES_DIRECT LOADED`

5. **р╕кр╣Ир╕Зр╕Вр╣Йр╕нр╕Др╕зр╕▓р╕бр╕Чр╕Фр╕кр╕нр╕Ъ**: "р╕кр╕зр╕▒р╕кр╕Фр╕╡р╕Др╕гр╕▒р╕Ъ"
6. р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ъ:
   - тЬЕ р╕Вр╣Йр╕нр╕Др╕зр╕▓р╕бр╕кр╣Ир╕Зр╕кр╕│р╣Ар╕гр╣Зр╕И
   - тЬЕ р╣Др╕бр╣Ир╕бр╕╡ error р╣Гр╕Щ Console
   - тЬЕ р╣Ар╕лр╣Зр╕Щр╕Вр╣Йр╕нр╕Др╕зр╕▓р╕б `тЬЕ MESSAGE SENT`

7. **р╕кр╣Ир╕Зр╕гр╕╣р╕Ыр╕ар╕▓р╕Юр╕Чр╕Фр╕кр╕нр╕Ъ**:
   - р╕Бр╕Фр╣Др╕нр╕Др╕нр╕Щр╕гр╕╣р╕Ыр╕ар╕▓р╕Ю
   - р╣Ар╕ер╕╖р╕нр╕Бр╕гр╕╣р╕Ы
   - тЬЕ р╕нр╕▒р╕Ыр╣Вр╕лр╕ер╕Фр╕кр╕│р╣Ар╕гр╣Зр╕И
   - тЬЕ р╣Ар╕лр╣Зр╕Щр╕гр╕╣р╕Ыр╣Гр╕Щр╣Бр╕Кр╕Ч

---

## ЁЯЪЧ р╕Чр╕Фр╕кр╕нр╕Ър╕Эр╕▒р╣Ир╕З Provider

### р╕Вр╕▒р╣Йр╕Щр╕Хр╕нр╕Щ

1. **Hard Refresh** р╕Хр╕▓р╕бр╕Фр╣Йр╕▓р╕Щр╕Ър╕Щ тЪая╕П
2. р╣Ар╕Ыр╕┤р╕Ф: `http://localhost:5173/provider/job/53a59c76-00b4-45d4-a7cd-0944d21ff896/matched`
3. р╕Бр╕Фр╣Др╕нр╕Др╕нр╕Щр╣Бр╕Кр╕Ч (ЁЯТм)
4. р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ъ Console (F12):
   - тЬЕ р╣Др╕бр╣Ир╕бр╕╡ error 400 Bad Request
   - тЬЕ р╣Др╕бр╣Ир╕бр╕╡ error 404 Not Found р╕кр╕│р╕лр╕гр╕▒р╕Ъ `mark_shopping_messages_read`
   - тЬЕ р╣Ар╕лр╣Зр╕Щр╕Вр╣Йр╕нр╕Др╕зр╕▓р╕б `тЬЕ INITIALIZE SUCCESS`

5. **р╕кр╣Ир╕Зр╕Вр╣Йр╕нр╕Др╕зр╕▓р╕бр╕Чр╕Фр╕кр╕нр╕Ъ**: "р╕гр╕▒р╕Ър╕Чр╕гр╕▓р╕Ър╕Др╕гр╕▒р╕Ъ"
6. р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ъ:
   - тЬЕ р╕Вр╣Йр╕нр╕Др╕зр╕▓р╕бр╕кр╣Ир╕Зр╕кр╕│р╣Ар╕гр╣Зр╕И
   - тЬЕ р╣Др╕бр╣Ир╕бр╕╡ error р╣Гр╕Щ Console
   - тЬЕ р╣Ар╕лр╣Зр╕Щр╕Вр╣Йр╕нр╕Др╕зр╕▓р╕б `тЬЕ MESSAGE SENT`

7. **р╕Чр╕Фр╕кр╕нр╕Ъ Realtime**:
   - р╣Ар╕Ыр╕┤р╕Фр╕лр╕Щр╣Йр╕▓р╕ер╕╣р╕Бр╕Др╣Йр╕▓р╣Гр╕Щр╣Бр╕Чр╣Зр╕Ър╕нр╕╖р╣Ир╕Щ
   - р╕кр╣Ир╕Зр╕Вр╣Йр╕нр╕Др╕зр╕▓р╕бр╕Ир╕▓р╕Бр╕ер╕╣р╕Бр╕Др╣Йр╕▓
   - тЬЕ Provider р╣Ар╕лр╣Зр╕Щр╕Вр╣Йр╕нр╕Др╕зр╕▓р╕бр╕Чр╕▒р╕Щр╕Чр╕╡ (р╣Др╕бр╣Ир╕Хр╣Йр╕нр╕З refresh)

---

## тЬЕ Checklist р╕Бр╕▓р╕гр╕Чр╕Фр╕кр╕нр╕Ъ

### р╕Эр╕▒р╣Ир╕Зр╕ер╕╣р╕Бр╕Др╣Йр╕▓

- [ ] Hard refresh р╣Бр╕ер╣Йр╕з
- [ ] р╣Ар╕Ыр╕┤р╕Фр╣Бр╕Кр╕Чр╣Др╕Фр╣Й (р╣Др╕бр╣Ир╕бр╕╡ 400 error)
- [ ] р╣Вр╕лр╕ер╕Фр╕Вр╣Йр╕нр╕Др╕зр╕▓р╕бр╣Ар╕Бр╣Ир╕▓р╣Др╕Фр╣Й
- [ ] р╕кр╣Ир╕Зр╕Вр╣Йр╕нр╕Др╕зр╕▓р╕бр╣Гр╕лр╕бр╣Ир╣Др╕Фр╣Й
- [ ] р╕кр╣Ир╕Зр╕гр╕╣р╕Ыр╕ар╕▓р╕Юр╣Др╕Фр╣Й
- [ ] р╣Др╕бр╣Ир╕бр╕╡ error р╣Гр╕Щ Console

### р╕Эр╕▒р╣Ир╕З Provider

- [ ] Hard refresh р╣Бр╕ер╣Йр╕з
- [ ] р╣Ар╕Ыр╕┤р╕Фр╣Бр╕Кр╕Чр╣Др╕Фр╣Й (р╣Др╕бр╣Ир╕бр╕╡ 400/404 error)
- [ ] р╣Вр╕лр╕ер╕Фр╕Вр╣Йр╕нр╕Др╕зр╕▓р╕бр╣Ар╕Бр╣Ир╕▓р╣Др╕Фр╣Й
- [ ] р╕кр╣Ир╕Зр╕Вр╣Йр╕нр╕Др╕зр╕▓р╕бр╣Гр╕лр╕бр╣Ир╣Др╕Фр╣Й
- [ ] р╕кр╣Ир╕Зр╕гр╕╣р╕Ыр╕ар╕▓р╕Юр╣Др╕Фр╣Й
- [ ] Realtime р╕Чр╕│р╕Зр╕▓р╕Щ (р╣Ар╕лр╣Зр╕Щр╕Вр╣Йр╕нр╕Др╕зр╕▓р╕бр╕Ир╕▓р╕Бр╕ер╕╣р╕Бр╕Др╣Йр╕▓р╕Чр╕▒р╕Щр╕Чр╕╡)
- [ ] р╣Др╕бр╣Ир╕бр╕╡ error р╣Гр╕Щ Console

---

## ЁЯРЫ р╕Цр╣Йр╕▓р╕вр╕▒р╕Зр╕бр╕╡р╕Ыр╕▒р╕Нр╕лр╕▓

### р╕Ыр╕▒р╕Нр╕лр╕▓: р╕вр╕▒р╕Зр╣Ар╕лр╣Зр╕Щ 400/404 error

**р╕кр╕▓р╣Ар╕лр╕Хр╕╕**: Browser cache р╕вр╕▒р╕Зр╣Др╕бр╣Ир╕Цр╕╣р╕Бр╕ер╣Йр╕▓р╕З

**р╕зр╕┤р╕Шр╕╡р╣Бр╕Бр╣Й**:

1. р╕Ыр╕┤р╕Фр╣Бр╕Чр╣Зр╕Ър╕Чр╕▒р╣Йр╕Зр╕лр╕бр╕Ф
2. р╕Ыр╕┤р╕Ф browser
3. р╣Ар╕Ыр╕┤р╕Ф browser р╣Гр╕лр╕бр╣И
4. Hard refresh р╕нр╕╡р╕Бр╕Др╕гр╕▒р╣Йр╕З (`Ctrl + Shift + R`)

### р╕Ыр╕▒р╕Нр╕лр╕▓: р╕Вр╣Йр╕нр╕Др╕зр╕▓р╕бр╣Др╕бр╣Ир╕кр╣Ир╕З

**р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ъ**:

1. р╣Ар╕Ыр╕┤р╕Ф Console (F12)
2. р╕Фр╕╣ error message
3. р╕Цр╣Ир╕▓р╕вр╕ар╕▓р╕Юр╕лр╕Щр╣Йр╕▓р╕Ир╕нр╕кр╣Ир╕Зр╕бр╕▓

### р╕Ыр╕▒р╕Нр╕лр╕▓: Realtime р╣Др╕бр╣Ир╕Чр╕│р╕Зр╕▓р╕Щ

**р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ъ**:

1. р╕Фр╕╣ Console р╕бр╕╡р╕Вр╣Йр╕нр╕Др╕зр╕▓р╕б `тЬЕ REALTIME SUBSCRIBED` р╕лр╕гр╕╖р╕нр╣Др╕бр╣И
2. р╕Цр╣Йр╕▓р╣Др╕бр╣Ир╕бр╕╡ р╣Гр╕лр╣Й refresh р╕лр╕Щр╣Йр╕▓р╣Гр╕лр╕бр╣И

---

## ЁЯУК Expected Console Logs

### р╣Ар╕бр╕╖р╣Ир╕нр╣Ар╕Ыр╕┤р╕Фр╣Бр╕Кр╕Ч (р╕Ыр╕Бр╕Хр╕┤)

```
[Chat 10:50:01.319] ЁЯЪА useChat CREATED
[Chat 10:50:03.795] ЁЯУЛ INITIALIZE START
[Chat 10:50:03.796] тЬЕ BOOKING_ID VALID
[Chat 10:50:03.931] тЬЕ USER AUTHENTICATED
[Chat 10:50:04.017] ЁЯУб RPC RESULT: get_user_shopping_role
[Chat 10:50:04.115] ЁЯУб RPC RESULT: is_shopping_chat_allowed
[Chat 10:50:04.211] ЁЯУб QUERY RESULT: shopping_requests.status
[Chat 10:50:04.212] ЁЯУК INITIALIZE COMPLETE
[Chat 10:50:04.302] ЁЯУе LOAD_MESSAGES RPC RESULT
[Chat 10:50:04.445] тЬЕ MESSAGES_DIRECT LOADED
[Chat 10:50:04.446] тЬЕ INITIALIZE SUCCESS
[Chat 10:50:04.876] тЬЕ REALTIME SUBSCRIBED
```

### р╣Ар╕бр╕╖р╣Ир╕нр╕кр╣Ир╕Зр╕Вр╣Йр╕нр╕Др╕зр╕▓р╕б (р╕Ыр╕Бр╕Хр╕┤)

```
[Chat 10:51:15.123] ЁЯУд SEND_MESSAGE START
[Chat 10:51:15.234] ЁЯУб RPC: send_shopping_chat_message
[Chat 10:51:15.345] ЁЯУб RPC RESULT: send_shopping_chat_message
[Chat 10:51:15.456] тЬЕ MESSAGE SENT
```

---

## ЁЯОп р╕кр╕гр╕╕р╕Ы

**р╕Ыр╕▒р╕Нр╕лр╕▓**: Parameter name р╣Др╕бр╣Ир╕Хр╕гр╕Зр╕Бр╕▒р╕Щ (`p_user_id` vs `p_sender_id`)  
**р╣Бр╕Бр╣Йр╣Др╕В**: р╣Гр╕Кр╣Й dynamic parameter names р╕Хр╕▓р╕б booking type  
**р╕Хр╣Йр╕нр╕Зр╕Чр╕│**: Hard refresh browser р╕Бр╣Ир╕нр╕Щр╕Чр╕Фр╕кр╕нр╕Ъ  
**р╕Др╕▓р╕Фр╕лр╕зр╕▒р╕З**: р╣Бр╕Кр╕Чр╕Чр╕│р╕Зр╕▓р╕Щр╣Др╕Фр╣Йр╕Чр╕▒р╣Йр╕З 2 р╕Эр╕▒р╣Ир╕Зр╣Вр╕Фр╕вр╣Др╕бр╣Ир╕бр╕╡ error

---

**р╕нр╕▒р╕Юр╣Ар╕Фр╕Чр╕ер╣Ир╕▓р╕кр╕╕р╕Ф**: 2026-01-27 10:55 р╕Щ.  
**р╕Юр╕гр╣Йр╕нр╕бр╕Чр╕Фр╕кр╕нр╕Ъ**: тЬЕ р╣Гр╕Кр╣И
