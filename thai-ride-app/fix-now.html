<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üîß ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏õ‡∏±‡∏ç‡∏´‡∏≤ providers_v2 ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        .container {
            background: white;
            border-radius: 20px;
            padding: 40px;
            max-width: 600px;
            width: 100%;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            text-align: center;
        }
        .header {
            margin-bottom: 30px;
        }
        .header h1 {
            color: #2d3748;
            font-size: 32px;
            margin-bottom: 10px;
        }
        .header p {
            color: #718096;
            font-size: 18px;
        }
        .error-box {
            background: #fed7d7;
            border: 2px solid #fc8181;
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
            text-align: left;
        }
        .error-box h3 {
            color: #c53030;
            margin-bottom: 10px;
        }
        .error-code {
            background: #2d3748;
            color: #e2e8f0;
            padding: 10px;
            border-radius: 6px;
            font-family: monospace;
            font-size: 12px;
        }
        .steps {
            margin: 30px 0;
            text-align: left;
        }
        .step {
            display: flex;
            align-items: flex-start;
            margin: 15px 0;
            padding: 15px;
            background: #f7fafc;
            border-radius: 10px;
            border-left: 4px solid #4299e1;
        }
        .step-number {
            background: #4299e1;
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-right: 15px;
            flex-shrink: 0;
        }
        .step-content h4 {
            color: #2d3748;
            margin-bottom: 5px;
        }
        .step-content p {
            color: #4a5568;
            font-size: 14px;
        }
        .big-button {
            background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);
            color: white;
            border: none;
            padding: 20px 40px;
            border-radius: 12px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(72, 187, 120, 0.3);
            margin: 10px;
            text-decoration: none;
            display: inline-block;
        }
        .big-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(72, 187, 120, 0.4);
        }
        .secondary-button {
            background: #4a5568;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 14px;
            cursor: pointer;
            margin: 5px;
            text-decoration: none;
            display: inline-block;
        }
        .secondary-button:hover {
            background: #2d3748;
        }
        .sql-box {
            background: #2d3748;
            color: #e2e8f0;
            padding: 20px;
            border-radius: 10px;
            font-family: monospace;
            font-size: 12px;
            text-align: left;
            max-height: 300px;
            overflow-y: auto;
            margin: 20px 0;
            border: 2px solid #4a5568;
        }
        .copy-btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            margin-top: 10px;
        }
        .copy-btn:hover {
            background: #5a67d8;
        }
        .success-box {
            background: #c6f6d5;
            border: 2px solid #68d391;
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
            display: none;
        }
        .success-box h3 {
            color: #22543d;
            margin-bottom: 10px;
        }
        .hidden { display: none; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üîß ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏ó‡∏±‡∏ô‡∏ó‡∏µ</h1>
            <p>‡∏ï‡∏≤‡∏£‡∏≤‡∏á providers_v2 ‡∏´‡∏≤‡∏¢‡πÑ‡∏õ - ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÉ‡∏ô 2 ‡∏ô‡∏≤‡∏ó‡∏µ</p>
        </div>

        <div class="error-box">
            <h3>‚ùå ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏à‡∏≠</h3>
            <div class="error-code">
Error: Could not find the table 'public.providers_v2' in the schema cache
Code: PGRST205
‡∏´‡∏ô‡πâ‡∏≤: /provider/onboarding
            </div>
            <p><strong>‡∏ú‡∏•‡∏Å‡∏£‡∏∞‡∏ó‡∏ö:</strong> ‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡πÄ‡∏õ‡πá‡∏ô‡πÑ‡∏£‡πÄ‡∏î‡∏≠‡∏£‡πå‡πÑ‡∏°‡πà‡∏ó‡∏≥‡∏á‡∏≤‡∏ô</p>
        </div>

        <div class="steps">
            <h3>üìã ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç (‡∏á‡πà‡∏≤‡∏¢‡∏°‡∏≤‡∏Å!)</h3>
            
            <div class="step">
                <div class="step-number">1</div>
                <div class="step-content">
                    <h4>Copy ‡πÇ‡∏Ñ‡πâ‡∏î SQL</h4>
                    <p>‡∏Ñ‡∏•‡∏¥‡∏Å‡∏õ‡∏∏‡πà‡∏°‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠ copy ‡πÇ‡∏Ñ‡πâ‡∏î‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</p>
                </div>
            </div>
            
            <div class="step">
                <div class="step-number">2</div>
                <div class="step-content">
                    <h4>‡πÄ‡∏õ‡∏¥‡∏î Supabase Dashboard</h4>
                    <p>‡πÑ‡∏õ‡∏ó‡∏µ‡πà SQL Editor ‡πÉ‡∏ô Supabase Dashboard</p>
                </div>
            </div>
            
            <div class="step">
                <div class="step-number">3</div>
                <div class="step-content">
                    <h4>‡∏ß‡∏≤‡∏á‡πÇ‡∏Ñ‡πâ‡∏î‡πÅ‡∏•‡∏∞ Run</h4>
                    <p>Paste ‡πÇ‡∏Ñ‡πâ‡∏î‡πÅ‡∏•‡πâ‡∏ß‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏° RUN</p>
                </div>
            </div>
            
            <div class="step">
                <div class="step-number">4</div>
                <div class="step-content">
                    <h4>‡∏ó‡∏î‡∏™‡∏≠‡∏ö</h4>
                    <p>‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏´‡∏ô‡πâ‡∏≤ /provider/onboarding</p>
                </div>
            </div>
        </div>

        <div style="margin: 30px 0;">
            <button class="big-button" onclick="showSQL()">
                üìã ‡πÅ‡∏™‡∏î‡∏á‡πÇ‡∏Ñ‡πâ‡∏î SQL
            </button>
            
            <a href="https://supabase.com/dashboard/project/onsflqhkgqhydeupiqyt/sql/new" 
               target="_blank" class="big-button">
                üîó ‡πÄ‡∏õ‡∏¥‡∏î Supabase Dashboard
            </a>
        </div>

        <div id="sqlSection" class="hidden">
            <h3>üìù ‡πÇ‡∏Ñ‡πâ‡∏î SQL ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</h3>
            <p><strong>‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥:</strong> Copy ‡πÇ‡∏Ñ‡πâ‡∏î‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ‡πÅ‡∏•‡πâ‡∏ß‡πÑ‡∏õ Paste ‡πÉ‡∏ô Supabase SQL Editor</p>
            
            <div class="sql-box" id="sqlCode">
-- üö® INSTANT FIX: ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ï‡∏≤‡∏£‡∏≤‡∏á providers_v2 ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
DO $$ 
BEGIN
    IF NOT EXISTS (SELECT FROM information_schema.tables WHERE table_name = 'providers_v2') THEN
        
        -- ‡∏™‡∏£‡πâ‡∏≤‡∏á enum types
        DO $enum$ BEGIN
          CREATE TYPE provider_status AS ENUM (
            'pending', 'pending_verification', 'approved', 'active', 'suspended', 'rejected'
          );
        EXCEPTION WHEN duplicate_object THEN NULL; END $enum$;

        DO $enum$ BEGIN
          CREATE TYPE service_type AS ENUM (
            'ride', 'delivery', 'shopping', 'moving', 'laundry'
          );
        EXCEPTION WHEN duplicate_object THEN NULL; END $enum$;

        -- ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ï‡∏≤‡∏£‡∏≤‡∏á providers_v2
        CREATE TABLE providers_v2 (
          id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
          user_id UUID REFERENCES auth.users(id) ON DELETE CASCADE UNIQUE NOT NULL,
          provider_uid TEXT UNIQUE,
          first_name TEXT NOT NULL,
          last_name TEXT NOT NULL,
          email TEXT NOT NULL,
          phone_number TEXT NOT NULL,
          status provider_status NOT NULL DEFAULT 'pending',
          service_types service_type[] NOT NULL DEFAULT '{}',
          is_online BOOLEAN DEFAULT FALSE,
          current_location GEOGRAPHY(POINT),
          rating DECIMAL(3,2) DEFAULT 0 CHECK (rating >= 0 AND rating <= 5),
          total_trips INTEGER DEFAULT 0 CHECK (total_trips >= 0),
          total_earnings DECIMAL(10,2) DEFAULT 0 CHECK (total_earnings >= 0),
          created_at TIMESTAMPTZ DEFAULT NOW(),
          updated_at TIMESTAMPTZ DEFAULT NOW(),
          approved_at TIMESTAMPTZ,
          suspended_at TIMESTAMPTZ,
          suspension_reason TEXT
        );

        -- ‡∏™‡∏£‡πâ‡∏≤‡∏á indexes
        CREATE INDEX idx_providers_v2_user_id ON providers_v2(user_id);
        CREATE INDEX idx_providers_v2_status ON providers_v2(status);

        -- ‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô RLS
        ALTER TABLE providers_v2 ENABLE ROW LEVEL SECURITY;

        -- ‡∏™‡∏£‡πâ‡∏≤‡∏á RLS policies
        CREATE POLICY "Providers can view own profile" ON providers_v2 FOR SELECT USING (auth.uid() = user_id);
        CREATE POLICY "Providers can update own profile" ON providers_v2 FOR UPDATE USING (auth.uid() = user_id);
        CREATE POLICY "Anyone can insert provider" ON providers_v2 FOR INSERT WITH CHECK (auth.uid() = user_id);
        
        -- Admin policies
        CREATE POLICY "Admins can view all providers" ON providers_v2 FOR SELECT USING (
          EXISTS (SELECT 1 FROM users WHERE users.id = auth.uid() AND users.role IN ('admin', 'super_admin'))
        );
        
        CREATE POLICY "Admins can update all providers" ON providers_v2 FOR UPDATE USING (
          EXISTS (SELECT 1 FROM users WHERE users.id = auth.uid() AND users.role IN ('admin', 'super_admin'))
        );

        RAISE NOTICE '‚úÖ ‡∏ï‡∏≤‡∏£‡∏≤‡∏á providers_v2 ‡∏ñ‡∏π‡∏Å‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß!';
    ELSE
        RAISE NOTICE '‚ö†Ô∏è ‡∏ï‡∏≤‡∏£‡∏≤‡∏á providers_v2 ‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß';
    END IF;
END $$;

-- ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå
SELECT 'providers_v2' as table_name, COUNT(*) as record_count, '‚úÖ ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô!' as status FROM providers_v2;
            </div>
            
            <button class="copy-btn" onclick="copySQL()">üìã Copy ‡πÇ‡∏Ñ‡πâ‡∏î SQL</button>
            
            <div style="margin-top: 20px;">
                <a href="/provider/onboarding" target="_blank" class="secondary-button">
                    üß™ ‡∏ó‡∏î‡∏™‡∏≠‡∏ö Provider Onboarding
                </a>
                <button class="secondary-button" onclick="checkStatus()">
                    üîç ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞
                </button>
            </div>
        </div>

        <div id="successBox" class="success-box">
            <h3>üéâ ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!</h3>
            <p>‡∏ï‡∏≤‡∏£‡∏≤‡∏á providers_v2 ‡∏ñ‡∏π‡∏Å‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß</p>
            <p><strong>‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ñ‡∏±‡∏î‡πÑ‡∏õ:</strong></p>
            <ul style="text-align: left; margin-top: 10px;">
                <li>‚úÖ ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏´‡∏ô‡πâ‡∏≤ /provider/onboarding</li>
                <li>‚úÖ ‡∏•‡∏≠‡∏á‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡πÄ‡∏õ‡πá‡∏ô‡πÑ‡∏£‡πÄ‡∏î‡∏≠‡∏£‡πå</li>
                <li>‚úÖ ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏£‡∏∞‡∏ö‡∏ö admin</li>
            </ul>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>
        // Initialize Supabase
        const { createClient } = supabase;
        const supabaseClient = createClient(
            'https://onsflqhkgqhydeupiqyt.supabase.co',
            'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9uc2ZscWhrZ3FoeWRldXBpcXl0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3MzQ0MzI2NzQsImV4cCI6MjA1MDAwODY3NH0.Ej_1Ej5-Ej5-Ej5-Ej5-Ej5-Ej5-Ej5-Ej5-Ej5-Ej5'
        );

        function showSQL() {
            document.getElementById('sqlSection').classList.remove('hidden');
        }

        function copySQL() {
            const sqlCode = document.getElementById('sqlCode').textContent;
            navigator.clipboard.writeText(sqlCode).then(() => {
                const btn = event.target;
                const originalText = btn.textContent;
                btn.textContent = '‚úÖ Copy ‡πÅ‡∏•‡πâ‡∏ß!';
                btn.style.background = '#48bb78';
                setTimeout(() => {
                    btn.textContent = originalText;
                    btn.style.background = '#667eea';
                }, 2000);
            }).catch(() => {
                alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÅ‡∏•‡∏∞ copy ‡πÇ‡∏Ñ‡πâ‡∏î‡∏î‡πâ‡∏ß‡∏¢‡∏ï‡∏ô‡πÄ‡∏≠‡∏á');
            });
        }

        async function checkStatus() {
            try {
                const { data, error } = await supabaseClient
                    .from('providers_v2')
                    .select('count')
                    .limit(1);

                if (error) {
                    if (error.code === 'PGRST116') {
                        alert('‚ùå ‡∏ï‡∏≤‡∏£‡∏≤‡∏á providers_v2 ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ\n‡∏Å‡∏£‡∏∏‡∏ì‡∏≤ run ‡πÇ‡∏Ñ‡πâ‡∏î SQL ‡πÉ‡∏ô Supabase Dashboard ‡∏Å‡πà‡∏≠‡∏ô');
                    } else {
                        alert('‚ùå Error: ' + error.message);
                    }
                } else {
                    document.getElementById('successBox').style.display = 'block';
                    alert('‚úÖ ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ‡∏ï‡∏≤‡∏£‡∏≤‡∏á providers_v2 ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÅ‡∏•‡πâ‡∏ß');
                }
            } catch (err) {
                alert('‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + err.message);
            }
        }

        // Auto-show SQL on load
        window.addEventListener('load', () => {
            setTimeout(showSQL, 1000);
        });
    </script>
</body>
</html>