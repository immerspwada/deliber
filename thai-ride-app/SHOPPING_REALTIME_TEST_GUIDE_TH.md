# 🧪 คู่มือทดสอบระบบ Realtime สำหรับ Shopping

**วันที่**: 2026-01-28  
**สถานะ**: ✅ พร้อมทดสอบ

---

## 🎯 สิ่งที่ต้องทดสอบ

ระบบ Realtime สำหรับ Shopping ทั้ง 3 Role:

1. **ลูกค้า** - รับการแจ้งเตือนทันทีเมื่อมีการอัพเดท
2. **ไรเดอร์** - เห็นงานใหม่ทันทีในหน้า Home
3. **แอดมิน** - เห็นออเดอร์ทั้งหมดแบบ Realtime

---

## 🚀 ขั้นตอนการทดสอบ

### ทดสอบที่ 1: ลูกค้าสร้างออเดอร์

**เตรียมการ**:

1. เปิด Browser Console (F12)
2. Login เป็นลูกค้า
3. ไปที่ `/customer/shopping`

**ขั้นตอน**:

1. กรอกข้อมูลร้านค้า
2. กรอกที่อยู่จัดส่ง
3. กรอกรายการสินค้า
4. กรอกงบประมาณ
5. กดยืนยันคำสั่งซื้อ

**ผลลัพธ์ที่คาดหวัง**:

```
✅ Console แสดง:
🔌 [ShoppingView] Subscribing to realtime updates for: <order_id>
✅ [ShoppingView] Realtime subscription active

✅ หน้าจอ:
- สร้างออเดอร์สำเร็จ
- ไปหน้า Tracking อัตโนมัติ
```

---

### ทดสอบที่ 2: ไรเดอร์รับงาน

**เตรียมการ**:

1. **เปิด Browser ลูกค้าทิ้งไว้** (จากทดสอบที่ 1)
2. เปิด Browser ใหม่
3. Login เป็นไรเดอร์
4. ไปที่ `/provider`

**ขั้นตอน**:

1. ดูงานใหม่ในหน้า Home
2. กดรับงาน Shopping ที่เพิ่งสร้าง
3. ดูที่ Browser ลูกค้า

**ผลลัพธ์ที่คาดหวัง**:

**Browser ลูกค้า - Console**:

```
🚗 [ShoppingView] Provider assigned: <order_id> <provider_id>
```

**Browser ลูกค้า - หน้าจอ**:

```
✅ แสดง Toast Notification:
"🎉 มีไรเดอร์รับงานแล้ว!"

✅ มีการสั่น (Haptic Feedback)
```

---

### ทดสอบที่ 3: เปลี่ยนสถานะ

**เตรียมการ**:

- Browser ลูกค้ายังเปิดอยู่
- Browser ไรเดอร์ยังเปิดอยู่

**ขั้นตอน**:

1. ไรเดอร์กด "เริ่มซื้อของ" (Status: matched → shopping)
2. ดูที่ Browser ลูกค้า

**ผลลัพธ์ที่คาดหวัง**:

**Browser ลูกค้า - Console**:

```
📊 [ShoppingView] Status changed: <order_id> shopping
```

**Browser ลูกค้า - หน้าจอ**:

```
✅ แสดง Toast Notification:
"สถานะเปลี่ยนเป็น: กำลังซื้อของ"
```

---

### ทดสอบที่ 4: เปลี่ยนสถานะหลายครั้ง

**ขั้นตอน**:

1. ไรเดอร์กด "รับของแล้ว" (Status: shopping → delivering)
2. ดูที่ Browser ลูกค้า
3. ไรเดอร์กด "ส่งของเรียบร้อย" (Status: delivering → completed)
4. ดูที่ Browser ลูกค้า

**ผลลัพธ์ที่คาดหวัง**:

```
✅ ลูกค้าได้รับการแจ้งเตือนทุกครั้งที่สถานะเปลี่ยน:
- "สถานะเปลี่ยนเป็น: กำลังจัดส่ง"
- "สถานะเปลี่ยนเป็น: เสร็จสิ้น"

✅ ทุก Notification แสดงข้อความภาษาไทยที่ถูกต้อง
✅ มีการสั่นทุกครั้ง
```

---

### ทดสอบที่ 5: แอดมินเห็นทันที

**เตรียมการ**:

1. เปิด Browser ใหม่
2. Login เป็น Admin
3. ไปที่ `/admin/shopping`

**ขั้นตอน**:

1. ดูรายการออเดอร์
2. ให้ลูกค้าสร้างออเดอร์ใหม่
3. ดูที่หน้าจอ Admin

**ผลลัพธ์ที่คาดหวัง**:

```
✅ ออเดอร์ใหม่ปรากฏทันทีในรายการ
✅ ไม่ต้อง Refresh หน้า
✅ เมื่อไรเดอร์รับงาน สถานะเปลี่ยนทันที
```

---

### ทดสอบที่ 6: Cleanup

**ขั้นตอน**:

1. สร้างออเดอร์ Shopping
2. ออกจากหน้า Shopping (กด Back หรือไปหน้าอื่น)
3. ดูที่ Console

**ผลลัพธ์ที่คาดหวัง**:

```
✅ Console แสดง:
🔌 [ShoppingView] Unsubscribing from realtime

✅ ไม่มี Memory Leak
✅ Connection ถูกปิดอย่างถูกต้อง
```

---

## 🔍 จุดที่ต้องสังเกต

### Console Messages

**ข้อความที่ควรเห็น**:

```javascript
// เมื่อสร้างออเดอร์
🔌 [ShoppingView] Subscribing to realtime updates for: <id>
✅ [ShoppingView] Realtime subscription active

// เมื่อไรเดอร์รับงาน
🚗 [ShoppingView] Provider assigned: <order_id> <provider_id>

// เมื่อสถานะเปลี่ยน
📊 [ShoppingView] Status changed: <order_id> <status>

// เมื่อมีการอัพเดท
🔄 [ShoppingView] Shopping order updated: <order>

// เมื่อออกจากหน้า
🔌 [ShoppingView] Unsubscribing from realtime
```

### Toast Notifications

**ข้อความที่ควรเห็น**:

- "🎉 มีไรเดอร์รับงานแล้ว!"
- "สถานะเปลี่ยนเป็น: กำลังซื้อของ"
- "สถานะเปลี่ยนเป็น: กำลังจัดส่ง"
- "สถานะเปลี่ยนเป็น: เสร็จสิ้น"
- "คำสั่งซื้อของคุณมีการอัพเดท"

### Haptic Feedback

**ควรสั่นเมื่อ**:

- ไรเดอร์รับงาน (สั่นแรง)
- สถานะเปลี่ยน (สั่นปานกลาง)
- มีการอัพเดท (สั่นเบา)

---

## ❌ ปัญหาที่อาจพบ

### ปัญหา 1: ไม่เห็น Console Message

**สาเหตุ**:

- ยังไม่ได้ Hard Refresh Browser

**วิธีแก้**:

```
1. กด Ctrl+Shift+R (Windows) หรือ Cmd+Shift+R (Mac)
2. หรือ Clear Cache แล้ว Refresh
```

### ปัญหา 2: ไม่เห็น Notification

**สาเหตุ**:

- Realtime ไม่ได้ Subscribe
- RLS Policy ไม่ถูกต้อง

**วิธีแก้**:

```
1. ตรวจสอบ Console ว่ามี Error หรือไม่
2. ตรวจสอบว่า Subscribe สำเร็จหรือไม่
3. ตรวจสอบ RLS Policy ใน Database
```

### ปัญหา 3: Notification ซ้ำ

**สาเหตุ**:

- Subscribe หลายครั้ง
- ไม่ได้ Cleanup

**วิธีแก้**:

```
1. Refresh หน้าใหม่
2. ตรวจสอบว่ามี Unsubscribe เมื่อออกจากหน้า
```

---

## ✅ Checklist การทดสอบ

### ลูกค้า (Customer)

- [ ] สร้างออเดอร์ → Subscribe Realtime สำเร็จ
- [ ] ไรเดอร์รับงาน → ได้รับ Notification
- [ ] สถานะเปลี่ยน → ได้รับ Notification
- [ ] ออกจากหน้า → Cleanup สำเร็จ
- [ ] กลับมาใหม่ → Reconnect สำเร็จ

### ไรเดอร์ (Provider)

- [ ] เห็นงานใหม่ทันทีในหน้า Home
- [ ] รับงาน → สถานะเปลี่ยนทันที
- [ ] อัพเดทสถานะ → ลูกค้าได้รับ Notification
- [ ] Upload รูป → ลูกค้าเห็นทันที

### แอดมิน (Admin)

- [ ] เห็นออเดอร์ใหม่ทันที
- [ ] เห็นการเปลี่ยนสถานะทันที
- [ ] ยกเลิกออเดอร์ → ลูกค้า/ไรเดอร์ได้รับ Notification
- [ ] ไม่ต้อง Refresh หน้า

---

## 🎯 เกณฑ์ผ่าน

| เกณฑ์                           | ผลลัพธ์    |
| ------------------------------- | ---------- |
| ลูกค้าได้รับ Notification ทันที | ⏳ รอทดสอบ |
| ไรเดอร์เห็นงานใหม่ทันที         | ⏳ รอทดสอบ |
| แอดมินเห็นทุกอย่างแบบ Realtime  | ⏳ รอทดสอบ |
| Notification แสดงข้อความถูกต้อง | ⏳ รอทดสอบ |
| Cleanup ทำงานถูกต้อง            | ⏳ รอทดสอบ |
| ไม่มี Memory Leak               | ⏳ รอทดสอบ |
| Performance ดี (< 500ms)        | ⏳ รอทดสอบ |

---

## 📝 บันทึกผลการทดสอบ

### ทดสอบวันที่: ******\_\_\_******

**ผู้ทดสอบ**: ******\_\_\_******

**ผลการทดสอบ**:

- [ ] ผ่านทุกข้อ
- [ ] มีปัญหา (ระบุด้านล่าง)

**ปัญหาที่พบ**:

```
1. _______________________________
2. _______________________________
3. _______________________________
```

**หมายเหตุ**:

```
_________________________________
_________________________________
_________________________________
```

---

## 🚀 หลังทดสอบเสร็จ

### ถ้าผ่านทุกข้อ

1. ✅ Deploy ขึ้น Production
2. ✅ แจ้งทีมให้ Hard Refresh Browser
3. ✅ Monitor Performance
4. ✅ รอ Feedback จากผู้ใช้

### ถ้ามีปัญหา

1. ❌ บันทึกปัญหาที่พบ
2. ❌ แก้ไขปัญหา
3. ❌ ทดสอบใหม่
4. ❌ Deploy เมื่อผ่านทุกข้อ

---

**สร้างเมื่อ**: 2026-01-28  
**อัพเดทล่าสุด**: 2026-01-28  
**สถานะ**: ✅ พร้อมทดสอบ
