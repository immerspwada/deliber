# ЁЯзк р╕Др╕╣р╣Ир╕бр╕╖р╕нр╕Чр╕Фр╕кр╕нр╕Ъ Shopping Wallet Fix

**р╕зр╕▒р╕Щр╕Чр╕╡р╣И**: 2026-01-28  
**р╕кр╕Цр╕▓р╕Щр╕░**: тЬЕ р╕Юр╕гр╣Йр╕нр╕бр╕Чр╕Фр╕кр╕нр╕Ъ

---

## ЁЯОп р╕кр╕┤р╣Ир╕Зр╕Чр╕╡р╣Ир╣Бр╕Бр╣Йр╣Др╕В

р╣Бр╕Бр╣Йр╕Ыр╕▒р╕Нр╕лр╕▓ **"р╕вр╕нр╕Фр╣Ар╕Зр╕┤р╕Щр╣Др╕бр╣Ир╣Ар╕Юр╕╡р╕вр╕Зр╕Юр╕н"** р╣Бр╕бр╣Йр╕зр╣Ир╕▓р╕Ир╕░р╕бр╕╡р╕вр╕нр╕Фр╣Ар╕Зр╕┤р╕Щр╣Гр╕Щр╕Бр╕гр╕░р╣Ар╕Ыр╣Лр╕▓

### р╕кр╕▓р╣Ар╕лр╕Хр╕╕

- р╕гр╕░р╕Ър╕Ър╕бр╕╡ 2 р╕Хр╕▓р╕гр╕▓р╕З wallet р╕Чр╕╡р╣Ир╣Др╕бр╣И sync р╕Бр╕▒р╕Щ
- Frontend р╕нр╣Ир╕▓р╕Щр╕Ир╕▓р╕Б `user_wallets.balance` (р╣Бр╕кр╕Фр╕З 1000 р╕Ър╕▓р╕Ч)
- Backend р╕нр╣Ир╕▓р╕Щр╕Ир╕▓р╕Б `users.wallet_balance` (р╕бр╕╡ 1000 р╕Ър╕▓р╕Ч)
- р╣Бр╕Хр╣И `user_wallets.balance` р╣Ар╕Ыр╣Зр╕Щ 0 р╕Ър╕▓р╕Чр╕Ир╕гр╕┤р╕Зр╣Ж

### р╕Бр╕▓р╕гр╣Бр╕Бр╣Йр╣Др╕В

1. тЬЕ Sync р╕вр╕нр╕Фр╣Ар╕Зр╕┤р╕Щр╕Чр╕▒р╣Йр╕З 2 р╕Хр╕▓р╕гр╕▓р╕З
2. тЬЕ р╕кр╕гр╣Йр╕▓р╕З trigger р╣Ар╕Юр╕╖р╣Ир╕н auto-sync р╕нр╕▒р╕Хр╣Вр╕Щр╕бр╕▒р╕Хр╕┤
3. тЬЕ р╕Чр╕Фр╕кр╕нр╕Ър╣Бр╕ер╣Йр╕зр╕зр╣Ир╕▓р╣Гр╕Кр╣Йр╕Зр╕▓р╕Щр╣Др╕Фр╣Й

---

## ЁЯФД р╕Вр╕▒р╣Йр╕Щр╕Хр╕нр╕Щр╕Бр╕▓р╕гр╕Чр╕Фр╕кр╕нр╕Ъ

### 1. Hard Refresh Browser (р╕кр╕│р╕Др╕▒р╕Нр╕бр╕▓р╕Б!)

**р╕Хр╣Йр╕нр╕Зр╕Чр╕│р╕Бр╣Ир╕нр╕Щр╕Чр╕Фр╕кр╕нр╕Ъ:**

```bash
# Windows/Linux
Ctrl + Shift + R

# Mac
Cmd + Shift + R
```

**р╕лр╕гр╕╖р╕н:**

1. р╣Ар╕Ыр╕┤р╕Ф DevTools (F12)
2. р╕Др╕ер╕┤р╕Бр╕Вр╕зр╕▓р╕Чр╕╡р╣Ир╕Ыр╕╕р╣Ир╕б Refresh
3. р╣Ар╕ер╕╖р╕нр╕Б "Empty Cache and Hard Reload"

---

### 2. р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕вр╕нр╕Фр╣Ар╕Зр╕┤р╕Щ

1. р╣Ар╕Вр╣Йр╕▓р╕кр╕╣р╣Ир╕гр╕░р╕Ър╕Ър╕Фр╣Йр╕зр╕в: `customer@test.com`
2. р╣Др╕Ыр╕Чр╕╡р╣Ир╕лр╕Щр╣Йр╕▓ Shopping (`/customer/shopping`)
3. р╕Фр╕╣р╕вр╕нр╕Фр╣Ар╕Зр╕┤р╕Щр╣Гр╕Щр╕Бр╕гр╕░р╣Ар╕Ыр╣Лр╕▓

**р╕Др╕зр╕гр╣Ар╕лр╣Зр╕Щ:**

```
ЁЯТ░ р╕вр╕нр╕Фр╣Ар╕Зр╕┤р╕Щр╕Др╕Зр╣Ар╕лр╕ер╕╖р╕н
р╕┐1,000.00
```

---

### 3. р╕Чр╕Фр╕кр╕нр╕Ър╕кр╕▒р╣Ир╕Зр╕Лр╕╖р╣Йр╕н

#### Step 1: р╣Ар╕ер╕╖р╕нр╕Бр╕гр╣Йр╕▓р╕Щр╕Др╣Йр╕▓

- р╣Ар╕ер╕╖р╕нр╕Б "р╕Хр╕│р╣Бр╕лр╕Щр╣Ир╕Зр╕Ыр╕▒р╕Ир╕Ир╕╕р╕Ър╕▒р╕Щ" р╕лр╕гр╕╖р╕н
- р╕Юр╕┤р╕бр╕Юр╣Мр╕Кр╕╖р╣Ир╕нр╕гр╣Йр╕▓р╕Щ р╣Ар╕Кр╣Ир╕Щ "7-Eleven"

#### Step 2: р╣Ар╕ер╕╖р╕нр╕Бр╕Чр╕╡р╣Ир╕нр╕вр╕╣р╣Ир╕Ир╕▒р╕Фр╕кр╣Ир╕З

- р╣Ар╕ер╕╖р╕нр╕Б "р╕Ър╣Йр╕▓р╕Щ" р╕лр╕гр╕╖р╕н
- р╕Юр╕┤р╕бр╕Юр╣Мр╕Чр╕╡р╣Ир╕нр╕вр╕╣р╣Ир╣Гр╕лр╕бр╣И

#### Step 3: р╕Бр╕гр╕нр╕Бр╕гр╕▓р╕вр╕Бр╕▓р╕гр╕кр╕┤р╕Щр╕Др╣Йр╕▓

```
р╕Щр╕б 2 р╕Бр╕ер╣Ир╕нр╕З
р╕Вр╕Щр╕бр╕Ыр╕▒р╕З 1 р╕лр╣Ир╕н
р╕Щр╣Йр╕│р╕Фр╕╖р╣Ир╕б 6 р╕Вр╕зр╕Ф
```

- р╕Зр╕Ър╕Ыр╕гр╕░р╕бр╕▓р╕У: р╣Ар╕ер╕╖р╕нр╕Б **500 р╕Ър╕▓р╕Ч**

#### Step 4: р╕вр╕╖р╕Щр╕вр╕▒р╕Щр╕Др╕│р╕кр╕▒р╣Ир╕Зр╕Лр╕╖р╣Йр╕н

**р╕Др╕зр╕гр╣Ар╕лр╣Зр╕Щ:**

```
ЁЯТ░ р╕вр╕нр╕Фр╣Ар╕Зр╕┤р╕Щр╕Др╕Зр╣Ар╕лр╕ер╕╖р╕н
р╕┐1,000.00

ЁЯУК р╕гр╕▓р╕вр╕ер╕░р╣Ар╕нр╕╡р╕вр╕Фр╕Др╣Ир╕▓р╣Гр╕Кр╣Йр╕Ир╣Ир╕▓р╕в
р╕вр╕нр╕Фр╕Др╕Зр╣Ар╕лр╕ер╕╖р╕нр╕Ыр╕▒р╕Ир╕Ир╕╕р╕Ър╕▒р╕Щ    р╕┐1,000.00
р╕лр╕▒р╕Бр╕Др╣Ир╕▓р╕Ър╕гр╕┤р╕Бр╕▓р╕г           -р╕┐XX.XX
р╕вр╕нр╕Фр╕Др╕Зр╣Ар╕лр╕ер╕╖р╕нр╕лр╕ер╕▒р╕Зр╕Кр╕│р╕гр╕░     р╕┐XXX.XX
```

- р╕Бр╕Фр╕Ыр╕╕р╣Ир╕б **"р╕вр╕╖р╕Щр╕вр╕▒р╕Щр╕Др╕│р╕кр╕▒р╣Ир╕Зр╕Лр╕╖р╣Йр╕н"**

**р╕Ьр╕ер╕ер╕▒р╕Юр╕Шр╣Мр╕Чр╕╡р╣Ир╕Др╕▓р╕Фр╕лр╕зр╕▒р╕З:**

- тЬЕ р╕кр╕гр╣Йр╕▓р╕Зр╕Др╕│р╕кр╕▒р╣Ир╕Зр╕Лр╕╖р╣Йр╕нр╕кр╕│р╣Ар╕гр╣Зр╕И
- тЬЕ р╣Др╕Ыр╕лр╕Щр╣Йр╕▓ Tracking р╕нр╕▒р╕Хр╣Вр╕Щр╕бр╕▒р╕Хр╕┤
- тЬЕ р╣Др╕бр╣Ир╕бр╕╡ error "р╕вр╕нр╕Фр╣Ар╕Зр╕┤р╕Щр╣Др╕бр╣Ир╣Ар╕Юр╕╡р╕вр╕Зр╕Юр╕н"

---

### 4. р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕вр╕нр╕Фр╣Ар╕Зр╕┤р╕Щр╕лр╕ер╕▒р╕Зр╕кр╕▒р╣Ир╕Зр╕Лр╕╖р╣Йр╕н

1. р╕Бр╕ер╕▒р╕Ър╣Др╕Ыр╕лр╕Щр╣Йр╕▓ Wallet (`/customer/wallet`)
2. р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕вр╕нр╕Фр╣Ар╕Зр╕┤р╕Щ

**р╕Др╕зр╕гр╣Ар╕лр╣Зр╕Щ:**

```
ЁЯТ░ р╕вр╕нр╕Фр╣Ар╕Зр╕┤р╕Щр╕Др╕Зр╣Ар╕лр╕ер╕╖р╕н
р╕┐XXX.XX  (р╕ер╕Фр╕ер╕Зр╕Хр╕▓р╕бр╕Др╣Ир╕▓р╕Ър╕гр╕┤р╕Бр╕▓р╕г)

ЁЯУЬ р╕Ыр╕гр╕░р╕зр╕▒р╕Хр╕┤р╕Бр╕▓р╕гр╕Чр╕│р╕гр╕▓р╕вр╕Бр╕▓р╕г
[р╕гр╕▓р╕вр╕Бр╕▓р╕гр╣Гр╕лр╕бр╣И] р╕Др╣Ир╕▓р╕Ър╕гр╕┤р╕Бр╕▓р╕гр╕Лр╕╖р╣Йр╕нр╕Вр╕нр╕З SHP-20260128-XXXXXX
```

---

## ЁЯРЫ р╕Бр╕гр╕Ур╕╡р╣Ар╕Ир╕нр╕Ыр╕▒р╕Нр╕лр╕▓

### р╕Ыр╕▒р╕Нр╕лр╕▓ 1: р╕вр╕▒р╕Зр╣Бр╕кр╕Фр╕З "р╕вр╕нр╕Фр╣Ар╕Зр╕┤р╕Щр╣Др╕бр╣Ир╣Ар╕Юр╕╡р╕вр╕Зр╕Юр╕н"

**р╕зр╕┤р╕Шр╕╡р╣Бр╕Бр╣Й:**

1. Hard refresh browser р╕нр╕╡р╕Бр╕Др╕гр╕▒р╣Йр╕З (Ctrl+Shift+R)
2. р╕ер╣Зр╕нр╕Бр╣Ар╕нр╕▓р╕Чр╣Мр╣Бр╕ер╣Йр╕зр╕ер╣Зр╕нр╕Бр╕нр╕┤р╕Щр╣Гр╕лр╕бр╣И
3. р╕ер╕нр╕Зр╣Гр╕Кр╣Й Incognito/Private mode

### р╕Ыр╕▒р╕Нр╕лр╕▓ 2: р╕вр╕нр╕Фр╣Ар╕Зр╕┤р╕Щр╣Бр╕кр╕Фр╕З 0 р╕Ър╕▓р╕Ч

**р╕зр╕┤р╕Шр╕╡р╣Бр╕Бр╣Й:**

1. Hard refresh browser
2. р╣Ар╕Кр╣Зр╕Др╕зр╣Ир╕▓р╕ер╣Зр╕нр╕Бр╕нр╕┤р╕Щр╕Фр╣Йр╕зр╕в user р╕Чр╕╡р╣Ир╕Цр╕╣р╕Бр╕Хр╣Йр╕нр╕З
3. р╕ер╕нр╕Зр╕гр╕╡р╣Ар╕Яр╕гр╕Кр╕лр╕Щр╣Йр╕▓р╣Ар╕зр╣Зр╕Ъ

### р╕Ыр╕▒р╕Нр╕лр╕▓ 3: Error р╕нр╕╖р╣Ир╕Щр╣Ж

**р╕кр╣Ир╕Зр╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Щр╕╡р╣Йр╕бр╕▓:**

1. р╣Ар╕Ыр╕┤р╕Ф Console (F12)
2. Copy error message р╕Чр╕▒р╣Йр╕Зр╕лр╕бр╕Ф
3. Screenshot р╕лр╕Щр╣Йр╕▓р╕Ир╕н
4. р╕Ър╕нр╕Б user р╕Чр╕╡р╣Ир╣Гр╕Кр╣Йр╕Чр╕Фр╕кр╕нр╕Ъ

---

## ЁЯУК р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╣Гр╕Щ Database (р╕кр╕│р╕лр╕гр╕▒р╕Ъ Dev)

### р╣Ар╕Кр╣Зр╕Др╕зр╣Ир╕▓ sync р╣Бр╕ер╣Йр╕з

```sql
SELECT
  u.email,
  u.wallet_balance as users_balance,
  uw.balance as wallet_balance,
  CASE
    WHEN u.wallet_balance = uw.balance THEN 'тЬЕ Synced'
    ELSE 'тЭМ Out of sync'
  END as status
FROM users u
INNER JOIN user_wallets uw ON uw.user_id = u.id
WHERE u.email = 'customer@test.com';
```

### р╣Ар╕Кр╣Зр╕Д trigger р╕Чр╕│р╕Зр╕▓р╕Щ

```sql
-- р╕ер╕Фр╕вр╕нр╕Фр╣Ар╕Зр╕┤р╕Щ 1 р╕Ър╕▓р╕Ч
UPDATE users
SET wallet_balance = wallet_balance - 1
WHERE email = 'customer@test.com';

-- р╣Ар╕Кр╣Зр╕Др╕зр╣Ир╕▓ user_wallets р╕ер╕Фр╕Хр╕▓р╕бр╣Др╕лр╕б
SELECT balance
FROM user_wallets uw
INNER JOIN users u ON u.id = uw.user_id
WHERE u.email = 'customer@test.com';
-- р╕Др╕зр╕гр╕ер╕Фр╕ер╕З 1 р╕Ър╕▓р╕Чр╕Фр╣Йр╕зр╕в
```

---

## тЬЕ Checklist р╕Бр╕▓р╕гр╕Чр╕Фр╕кр╕нр╕Ъ

- [ ] Hard refresh browser р╣Бр╕ер╣Йр╕з
- [ ] р╕ер╣Зр╕нр╕Бр╕нр╕┤р╕Щр╕Фр╣Йр╕зр╕в customer@test.com
- [ ] р╣Ар╕лр╣Зр╕Щр╕вр╕нр╕Фр╣Ар╕Зр╕┤р╕Щ 1000 р╕Ър╕▓р╕Ч
- [ ] р╕кр╕гр╣Йр╕▓р╕Зр╕Др╕│р╕кр╕▒р╣Ир╕Зр╕Лр╕╖р╣Йр╕нр╕кр╕│р╣Ар╕гр╣Зр╕И
- [ ] р╣Др╕Ыр╕лр╕Щр╣Йр╕▓ Tracking р╣Др╕Фр╣Й
- [ ] р╕вр╕нр╕Фр╣Ар╕Зр╕┤р╕Щр╕ер╕Фр╕ер╕Зр╕Хр╕▓р╕бр╕Др╣Ир╕▓р╕Ър╕гр╕┤р╕Бр╕▓р╕г
- [ ] р╣Др╕бр╣Ир╕бр╕╡ error "р╕вр╕нр╕Фр╣Ар╕Зр╕┤р╕Щр╣Др╕бр╣Ир╣Ар╕Юр╕╡р╕вр╕Зр╕Юр╕н"

---

## ЁЯОЙ р╕Ьр╕ер╕ер╕▒р╕Юр╕Шр╣Мр╕Чр╕╡р╣Ир╕Др╕▓р╕Фр╕лр╕зр╕▒р╕З

### р╕Бр╣Ир╕нр╕Щр╣Бр╕Бр╣Йр╣Др╕В тЭМ

```
1. р╣Ар╕лр╣Зр╕Щр╕вр╕нр╕Фр╣Ар╕Зр╕┤р╕Щ 1000 р╕Ър╕▓р╕Ч
2. р╕Бр╕Фр╕вр╕╖р╕Щр╕вр╕▒р╕Щр╕Др╕│р╕кр╕▒р╣Ир╕Зр╕Лр╕╖р╣Йр╕н
3. Error: "р╕вр╕нр╕Фр╣Ар╕Зр╕┤р╕Щр╣Др╕бр╣Ир╣Ар╕Юр╕╡р╕вр╕Зр╕Юр╕н"
4. р╕Зр╕З р╕Чр╕│р╣Др╕бр╣Ар╕Зр╕┤р╕Щр╕бр╕╡р╣Бр╕Хр╣Ир╕кр╕▒р╣Ир╕Зр╣Др╕бр╣Ир╣Др╕Фр╣Й
```

### р╕лр╕ер╕▒р╕Зр╣Бр╕Бр╣Йр╣Др╕В тЬЕ

```
1. р╣Ар╕лр╣Зр╕Щр╕вр╕нр╕Фр╣Ар╕Зр╕┤р╕Щ 1000 р╕Ър╕▓р╕Ч
2. р╕Бр╕Фр╕вр╕╖р╕Щр╕вр╕▒р╕Щр╕Др╕│р╕кр╕▒р╣Ир╕Зр╕Лр╕╖р╣Йр╕н
3. р╕кр╕гр╣Йр╕▓р╕Зр╕Др╕│р╕кр╕▒р╣Ир╕Зр╕Лр╕╖р╣Йр╕нр╕кр╕│р╣Ар╕гр╣Зр╕И
4. р╣Др╕Ыр╕лр╕Щр╣Йр╕▓ Tracking
5. р╕вр╕нр╕Фр╣Ар╕Зр╕┤р╕Щр╕ер╕Фр╕ер╕Зр╕Хр╕▓р╕бр╕Др╣Ир╕▓р╕Ър╕гр╕┤р╕Бр╕▓р╕г
```

---

## ЁЯУЮ р╕Хр╕┤р╕Фр╕Хр╣Ир╕н

р╕лр╕▓р╕Бр╣Ар╕Ир╕нр╕Ыр╕▒р╕Нр╕лр╕▓р╕лр╕гр╕╖р╕нр╕бр╕╡р╕Др╕│р╕Цр╕▓р╕б:

1. р╣Ар╕Ыр╕┤р╕Ф Console (F12)
2. Copy error message
3. Screenshot р╕лр╕Щр╣Йр╕▓р╕Ир╕н
4. р╕кр╣Ир╕Зр╕бр╕▓р╕Юр╕гр╣Йр╕нр╕бр╕гр╕▓р╕вр╕ер╕░р╣Ар╕нр╕╡р╕вр╕Ф

---

**р╕кр╕Цр╕▓р╕Щр╕░**: тЬЕ р╕Юр╕гр╣Йр╕нр╕бр╕Чр╕Фр╕кр╕нр╕Ъ  
**р╕нр╕▒р╕Юр╣Ар╕Фр╕Чр╕ер╣Ир╕▓р╕кр╕╕р╕Ф**: 2026-01-28
