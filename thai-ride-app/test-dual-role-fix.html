<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dual Role System Test</title>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
</head>
<body>
    <h1>Dual Role System Test</h1>
    <div id="results"></div>

    <script>
        const supabaseUrl = 'https://your-project.supabase.co'
        const supabaseKey = 'your-anon-key'
        const supabase = window.supabase.createClient(supabaseUrl, supabaseKey)

        async function testDualRoleSystem() {
            const results = document.getElementById('results')
            
            try {
                // Test 1: Check if providers_v2 table exists and has data
                results.innerHTML += '<h2>Test 1: Check providers_v2 table</h2>'
                
                const { data: providers, error: providersError } = await supabase
                    .from('providers_v2')
                    .select('id, user_id, status')
                    .limit(5)
                
                if (providersError) {
                    results.innerHTML += `<p style="color: red;">‚ùå Error: ${providersError.message}</p>`
                } else {
                    results.innerHTML += `<p style="color: green;">‚úÖ Found ${providers.length} providers in providers_v2</p>`
                    results.innerHTML += `<pre>${JSON.stringify(providers, null, 2)}</pre>`
                }

                // Test 2: Check if service_providers table exists (old table)
                results.innerHTML += '<h2>Test 2: Check service_providers table</h2>'
                
                const { data: oldProviders, error: oldError } = await supabase
                    .from('service_providers')
                    .select('id, user_id, status')
                    .limit(5)
                
                if (oldError) {
                    results.innerHTML += `<p style="color: orange;">‚ö†Ô∏è Old table error: ${oldError.message}</p>`
                } else {
                    results.innerHTML += `<p style="color: blue;">‚ÑπÔ∏è Found ${oldProviders.length} providers in service_providers (old table)</p>`
                }

                // Test 3: Check table consistency
                results.innerHTML += '<h2>Test 3: Table Consistency Analysis</h2>'
                
                if (!providersError && !oldError) {
                    const newCount = providers.length
                    const oldCount = oldProviders.length
                    
                    if (newCount > 0 && oldCount > 0) {
                        results.innerHTML += '<p style="color: red;">‚ùå INCONSISTENCY: Both tables have data - this causes dual-role issues!</p>'
                        results.innerHTML += '<p>üîß <strong>Fix needed:</strong> Migrate all components to use providers_v2</p>'
                    } else if (newCount > 0) {
                        results.innerHTML += '<p style="color: green;">‚úÖ Using new providers_v2 table correctly</p>'
                    } else if (oldCount > 0) {
                        results.innerHTML += '<p style="color: orange;">‚ö†Ô∏è Still using old service_providers table</p>'
                    }
                }

            } catch (error) {
                results.innerHTML += `<p style="color: red;">‚ùå Test failed: ${error.message}</p>`
            }
        }

        // Run test when page loads
        testDualRoleSystem()
    </script>
</body>
</html>