<script setup lang="ts">
import { ref, computed, onMounted, onUnmounted } from 'vue'
import { useRoute, useRouter } from 'vue-router'
import { useDelivery, type DeliveryRequest } from '../composables/useDelivery'
import { supabase } from '../lib/supabase'
import { useToast } from '../composables/useToast'

// Provider details from database query (for UUID-based queries)
interface ProviderDetails {
  id: string
  first_name: string
  last_name: string
  phone_number: string
  rating: number
  vehicle_type: string
  vehicle_plate: string
}

// Flexible delivery type that accepts both provider structures
type DeliveryWithProvider = Omit<DeliveryRequest, 'provider'> & {
  provider?: ProviderDetails | DeliveryRequest['provider']
}

const route = useRoute()
const router = useRouter()
const toast = useToast()
const { getDeliveryByTrackingId, subscribeToDelivery } = useDelivery()

const trackingId = computed(() => route.params.trackingId as string)
const delivery = ref<DeliveryWithProvider | null>(null)
const loading = ref(true)
const error = ref<string | null>(null)
const providerLocation = ref<{ lat: number; lng: number } | null>(null)

let subscription: { unsubscribe: () => void } | null = null

// Status configuration
const statusConfig: Record<string, { label: string; icon: string; description: string }> = {
  pending: {
    label: '‡∏£‡∏≠‡∏Ñ‡∏ô‡∏Ç‡∏±‡∏ö‡∏£‡∏±‡∏ö‡∏á‡∏≤‡∏ô',
    icon: '‚è≥',
    description: '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏Ñ‡∏ô‡∏Ç‡∏±‡∏ö‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°'
  },
  matched: {
    label: '‡∏Ñ‡∏ô‡∏Ç‡∏±‡∏ö‡∏£‡∏±‡∏ö‡∏á‡∏≤‡∏ô‡πÅ‡∏•‡πâ‡∏ß',
    icon: 'üë§',
    description: '‡∏Ñ‡∏ô‡∏Ç‡∏±‡∏ö‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏ï‡∏±‡∏ß‡πÑ‡∏õ‡∏£‡∏±‡∏ö‡∏û‡∏±‡∏™‡∏î‡∏∏'
  },
  pickup: {
    label: '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÑ‡∏õ‡∏£‡∏±‡∏ö‡∏û‡∏±‡∏™‡∏î‡∏∏',
    icon: 'üöó',
    description: '‡∏Ñ‡∏ô‡∏Ç‡∏±‡∏ö‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡∏à‡∏∏‡∏î‡∏£‡∏±‡∏ö‡∏û‡∏±‡∏™‡∏î‡∏∏'
  },
  in_transit: {
    label: '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏à‡∏±‡∏î‡∏™‡πà‡∏á',
    icon: 'üì¶',
    description: '‡∏û‡∏±‡∏™‡∏î‡∏∏‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏≠‡∏¢‡∏π‡πà‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏™‡πà‡∏á'
  },
  delivered: {
    label: '‡∏™‡πà‡∏á‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à',
    icon: '‚úÖ',
    description: '‡∏û‡∏±‡∏™‡∏î‡∏∏‡∏ñ‡∏π‡∏Å‡∏™‡πà‡∏á‡∏ñ‡∏∂‡∏á‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß'
  },
  failed: {
    label: '‡∏™‡πà‡∏á‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à',
    icon: '‚ùå',
    description: '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏™‡πà‡∏á‡∏û‡∏±‡∏™‡∏î‡∏∏‡πÑ‡∏î‡πâ'
  },
  cancelled: {
    label: '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å',
    icon: 'üö´',
    description: '‡∏Ñ‡∏≥‡∏Ç‡∏≠‡∏ñ‡∏π‡∏Å‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å'
  }
}

const currentStatus = computed(() => {
  if (!delivery.value) return null
  return statusConfig[delivery.value.status] || statusConfig.pending
})

const statusProgress = computed(() => {
  if (!delivery.value) return 0
  const statusOrder = ['pending', 'matched', 'pickup', 'in_transit', 'delivered']
  const currentIndex = statusOrder.indexOf(delivery.value.status)
  return ((currentIndex + 1) / statusOrder.length) * 100
})

const formatDate = (dateStr: string | null) => {
  if (!dateStr) return '-'
  const date = new Date(dateStr)
  return date.toLocaleDateString('th-TH', {
    year: 'numeric',
    month: 'short',
    day: 'numeric',
    hour: '2-digit',
    minute: '2-digit'
  })
}

const formatCurrency = (amount: number | null) => {
  if (!amount) return '‡∏ø0'
  return `‡∏ø${amount.toFixed(2)}`
}

const loadDelivery = async () => {
  loading.value = true
  error.value = null
  
  try {
    const identifier = trackingId.value
    let data = null
    
    // Check if identifier is UUID (contains dashes in UUID format)
    const isUUID = /^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(identifier)
    
    if (isUUID) {
      // Query by ID (UUID)
      const { data: result, error: queryError } = await supabase
        .from('delivery_requests')
        .select(`
          *,
          provider:providers_v2!delivery_requests_provider_id_fkey (
            id,
            first_name,
            last_name,
            phone_number,
            rating,
            vehicle_type,
            vehicle_plate
          )
        `)
        .eq('id', identifier)
        .single()
      
      if (queryError) {
        console.error('Query error:', queryError)
        error.value = '‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏™‡πà‡∏á‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö ID ‡∏ô‡∏µ‡πâ'
        return
      }
      
      data = result
    } else {
      // Query by tracking_id
      data = await getDeliveryByTrackingId(identifier)
    }
    
    if (!data) {
      error.value = '‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏™‡πà‡∏á'
      return
    }
    
    delivery.value = data
    
    // Subscribe to real-time updates
    if (data.id) {
      subscription = subscribeToDelivery(data.id, (updated) => {
        delivery.value = updated
      })
    }
    
    // Load provider location if available
    if (data.provider_id && ['pickup', 'in_transit'].includes(data.status)) {
      loadProviderLocation(data.provider_id)
    }
  } catch (err) {
    console.error('Error loading delivery:', err)
    error.value = '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•'
  } finally {
    loading.value = false
  }
}

const loadProviderLocation = async (providerId: string) => {
  try {
    const { data, error } = await supabase
      .from('provider_locations')
      .select('latitude, longitude')
      .eq('provider_id', providerId)
      .order('updated_at', { ascending: false })
      .limit(1)
      .maybeSingle<{ latitude: number; longitude: number }>()
    
    if (!error && data) {
      providerLocation.value = {
        lat: data.latitude,
        lng: data.longitude
      }
    }
  } catch (err) {
    console.error('Error loading provider location:', err)
  }
}

const goBack = () => {
  router.back()
}

const copyTrackingId = async () => {
  try {
    await navigator.clipboard.writeText(trackingId.value)
    toast.success('‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å Tracking ID ‡πÅ‡∏•‡πâ‡∏ß')
  } catch (err) {
    console.error('Failed to copy:', err)
    toast.error('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÑ‡∏î‡πâ')
  }
}

onMounted(() => {
  loadDelivery()
})

onUnmounted(() => {
  if (subscription) {
    subscription.unsubscribe()
  }
})
</script>

<template>
  <div class="tracking-page">
    <!-- Minimal Header -->
    <header class="tracking-header">
      <div class="tracking-container">
        <button
          type="button"
          class="tracking-back-btn"
          @click="goBack"
          aria-label="‡∏Å‡∏•‡∏±‡∏ö"
        >
          <svg class="tracking-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
          </svg>
          ‡∏Å‡∏•‡∏±‡∏ö
        </button>
      </div>
    </header>

    <!-- Loading -->
    <div v-if="loading" class="tracking-state">
      <div class="tracking-spinner"></div>
      <p class="tracking-state-text">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</p>
    </div>

    <!-- Error -->
    <div v-else-if="error" class="tracking-state">
      <div class="tracking-emoji">üòï</div>
      <h2 class="tracking-state-title">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</h2>
      <p class="tracking-state-text">{{ error }}</p>
      <button
        type="button"
        class="tracking-retry-btn"
        @click="loadDelivery"
      >
        ‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà
      </button>
    </div>

    <!-- Content -->
    <main v-else-if="delivery" class="tracking-main">
      <!-- Status -->
      <div class="tracking-status">
        <div class="tracking-status-icon">
          {{ currentStatus?.icon }}
        </div>
        <h1 class="tracking-status-title">{{ currentStatus?.label }}</h1>
        <p class="tracking-status-desc">{{ currentStatus?.description }}</p>
      </div>

      <!-- Progress -->
      <div class="tracking-progress-wrapper">
        <div class="tracking-progress-bar">
          <div
            class="tracking-progress-fill"
            :style="{ width: `${statusProgress}%` }"
          ></div>
        </div>
      </div>

      <!-- Tracking ID -->
      <div class="tracking-section">
        <div class="tracking-section-header">
          <span class="tracking-label">Tracking ID</span>
          <button
            type="button"
            class="tracking-copy-btn"
            @click="copyTrackingId"
            aria-label="‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å"
          >
            ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å
          </button>
        </div>
        <p class="tracking-id">{{ trackingId }}</p>
      </div>

      <!-- Timeline -->
      <div class="tracking-section">
        <h2 class="tracking-section-title">‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥</h2>
        <div class="tracking-timeline">
          <div v-if="delivery.created_at" class="tracking-timeline-item">
            <div class="tracking-timeline-dot"></div>
            <div class="tracking-timeline-content">
              <p class="tracking-timeline-title">‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ñ‡∏≥‡∏Ç‡∏≠</p>
              <p class="tracking-timeline-time">{{ formatDate(delivery.created_at) }}</p>
            </div>
          </div>
          <div v-if="delivery.picked_up_at" class="tracking-timeline-item">
            <div class="tracking-timeline-dot"></div>
            <div class="tracking-timeline-content">
              <p class="tracking-timeline-title">‡∏£‡∏±‡∏ö‡∏û‡∏±‡∏™‡∏î‡∏∏‡πÅ‡∏•‡πâ‡∏ß</p>
              <p class="tracking-timeline-time">{{ formatDate(delivery.picked_up_at) }}</p>
            </div>
          </div>
          <div v-if="delivery.delivered_at" class="tracking-timeline-item">
            <div class="tracking-timeline-dot"></div>
            <div class="tracking-timeline-content">
              <p class="tracking-timeline-title">‡∏™‡πà‡∏á‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à</p>
              <p class="tracking-timeline-time">{{ formatDate(delivery.delivered_at) }}</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Locations -->
      <div class="tracking-section">
        <h2 class="tracking-section-title">‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà</h2>
        
        <!-- Pickup -->
        <div class="tracking-location">
          <div class="tracking-location-header">
            <div class="tracking-location-badge tracking-location-badge-light">A</div>
            <span class="tracking-location-label">‡∏à‡∏∏‡∏î‡∏£‡∏±‡∏ö</span>
          </div>
          <p class="tracking-location-name">{{ delivery.sender_name }}</p>
          <p class="tracking-location-detail">{{ delivery.sender_phone }}</p>
          <p class="tracking-location-detail">{{ delivery.sender_address }}</p>
        </div>

        <!-- Dropoff -->
        <div class="tracking-location">
          <div class="tracking-location-header">
            <div class="tracking-location-badge tracking-location-badge-dark">B</div>
            <span class="tracking-location-label">‡∏à‡∏∏‡∏î‡∏™‡πà‡∏á</span>
          </div>
          <p class="tracking-location-name">{{ delivery.recipient_name }}</p>
          <p class="tracking-location-detail">{{ delivery.recipient_phone }}</p>
          <p class="tracking-location-detail">{{ delivery.recipient_address }}</p>
        </div>
      </div>

      <!-- Package Details -->
      <div class="tracking-section">
        <h2 class="tracking-section-title">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</h2>
        <dl class="tracking-details">
          <div class="tracking-detail-row">
            <dt class="tracking-detail-label">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</dt>
            <dd class="tracking-detail-value">{{ delivery.package_type }}</dd>
          </div>
          <div class="tracking-detail-row">
            <dt class="tracking-detail-label">‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å</dt>
            <dd class="tracking-detail-value">{{ delivery.package_weight }} ‡∏Å‡∏Å.</dd>
          </div>
          <div class="tracking-detail-row">
            <dt class="tracking-detail-label">‡∏£‡∏∞‡∏¢‡∏∞‡∏ó‡∏≤‡∏á</dt>
            <dd class="tracking-detail-value">{{ delivery.distance_km }} ‡∏Å‡∏°.</dd>
          </div>
          <div class="tracking-detail-row tracking-detail-row-total">
            <dt class="tracking-detail-label-total">‡∏Ñ‡πà‡∏≤‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£</dt>
            <dd class="tracking-detail-value-total">{{ formatCurrency(delivery.estimated_fee) }}</dd>
          </div>
        </dl>
        <div v-if="delivery.package_description" class="tracking-notes">
          <p class="tracking-notes-label">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏</p>
          <p class="tracking-notes-text">{{ delivery.package_description }}</p>
        </div>
      </div>

      <!-- Driver Info -->
      <div v-if="delivery.provider && 'first_name' in delivery.provider" class="tracking-section">
        <h2 class="tracking-section-title">‡∏Ñ‡∏ô‡∏Ç‡∏±‡∏ö</h2>
        <div class="tracking-driver">
          <div class="tracking-driver-avatar">
            <svg class="tracking-driver-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
            </svg>
          </div>
          <div class="tracking-driver-info">
            <p class="tracking-driver-name">
              {{ delivery.provider.first_name }} {{ delivery.provider.last_name }}
            </p>
            <p class="tracking-driver-vehicle">{{ delivery.provider.vehicle_type }} ‚Ä¢ {{ delivery.provider.vehicle_plate }}</p>
            <div class="tracking-driver-rating">
              <svg class="tracking-rating-icon" fill="currentColor" viewBox="0 0 20 20">
                <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" />
              </svg>
              <span class="tracking-rating-text">{{ delivery.provider.rating?.toFixed(1) || '5.0' }}</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Help -->
      <div class="tracking-help">
        <p class="tracking-help-text">‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡πà‡∏ß‡∏¢‡πÄ‡∏´‡∏•‡∏∑‡∏≠?</p>
        <p class="tracking-help-text">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡∏ù‡πà‡∏≤‡∏¢‡∏™‡∏ô‡∏±‡∏ö‡∏™‡∏ô‡∏∏‡∏ô‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</p>
      </div>
    </main>
  </div>
</template>

<style scoped>
/* ===== TRACKING PAGE ISOLATED STYLES ===== */
/* Reset global CSS interference */
.tracking-page {
  all: initial;
  * {
    all: unset;
  }
}

/* Base styles */
.tracking-page {
  display: block;
  min-height: 100vh;
  background-color: #ffffff;
  font-family: 'Sarabun', -apple-system, BlinkMacSystemFont, sans-serif;
  color: #1a1a1a;
  line-height: 1.5;
}

/* Header */
.tracking-header {
  display: block;
  border-bottom: 1px solid #f0f0f0;
}

.tracking-container {
  display: block;
  max-width: 48rem;
  margin: 0 auto;
  padding: 1.5rem;
}

.tracking-back-btn {
  display: inline-flex;
  align-items: center;
  gap: 0.5rem;
  font-size: 0.875rem;
  color: #666666;
  cursor: pointer;
  background: none;
  border: none;
  padding: 0;
}

.tracking-back-btn:hover {
  color: #1a1a1a;
}

.tracking-icon {
  display: block;
  width: 1rem;
  height: 1rem;
}

/* Loading & Error States */
.tracking-state {
  display: block;
  max-width: 48rem;
  margin: 0 auto;
  padding: 5rem 1.5rem;
  text-align: center;
}

.tracking-spinner {
  display: inline-block;
  width: 2rem;
  height: 2rem;
  border: 2px solid #e8e8e8;
  border-top-color: #1a1a1a;
  border-radius: 50%;
  animation: tracking-spin 1s linear infinite;
  margin-bottom: 1rem;
}

@keyframes tracking-spin {
  from { transform: rotate(0deg); }
  to { transform: rotate(360deg); }
}

.tracking-emoji {
  font-size: 2.5rem;
  margin-bottom: 1rem;
}

.tracking-state-title {
  font-size: 1.125rem;
  font-weight: 500;
  color: #1a1a1a;
  margin-bottom: 0.5rem;
}

.tracking-state-text {
  font-size: 0.875rem;
  color: #666666;
  margin-bottom: 1.5rem;
}

.tracking-retry-btn {
  display: inline-flex;
  align-items: center;
  gap: 0.5rem;
  padding: 0.5rem 1rem;
  font-size: 0.875rem;
  font-weight: 500;
  color: #1a1a1a;
  border: 1px solid #e8e8e8;
  border-radius: 0.5rem;
  cursor: pointer;
  background: #ffffff;
}

.tracking-retry-btn:hover {
  background: #f5f5f5;
}

/* Main Content */
.tracking-main {
  display: block;
  max-width: 48rem;
  margin: 0 auto;
  padding: 3rem 1.5rem;
}

/* Status */
.tracking-status {
  display: block;
  margin-bottom: 3rem;
  text-align: center;
}

.tracking-status-icon {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  width: 4rem;
  height: 4rem;
  margin-bottom: 1rem;
  font-size: 1.875rem;
  background-color: #f5f5f5;
  border-radius: 50%;
}

.tracking-status-title {
  font-size: 1.5rem;
  font-weight: 500;
  color: #1a1a1a;
  margin-bottom: 0.5rem;
}

.tracking-status-desc {
  font-size: 0.875rem;
  color: #666666;
}

/* Progress Bar */
.tracking-progress-wrapper {
  display: block;
  margin-bottom: 3rem;
}

.tracking-progress-bar {
  height: 0.25rem;
  background-color: #f0f0f0;
  border-radius: 9999px;
  overflow: hidden;
}

.tracking-progress-fill {
  height: 100%;
  background-color: #1a1a1a;
  transition: width 0.7s ease;
}

/* Section */
.tracking-section {
  display: block;
  margin-bottom: 3rem;
  padding-bottom: 3rem;
  border-bottom: 1px solid #f0f0f0;
}

.tracking-section-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: 0.5rem;
}

.tracking-label {
  font-size: 0.75rem;
  text-transform: uppercase;
  letter-spacing: 0.05em;
  color: #999999;
  font-weight: 500;
}

.tracking-copy-btn {
  font-size: 0.75rem;
  color: #666666;
  cursor: pointer;
  background: none;
  border: none;
  padding: 0;
}

.tracking-copy-btn:hover {
  color: #1a1a1a;
}

.tracking-id {
  font-family: 'Courier New', monospace;
  font-size: 0.875rem;
  color: #1a1a1a;
}

.tracking-section-title {
  font-size: 0.75rem;
  text-transform: uppercase;
  letter-spacing: 0.05em;
  color: #999999;
  font-weight: 500;
  margin-bottom: 1.5rem;
}

/* Timeline */
.tracking-timeline {
  display: block;
}

.tracking-timeline-item {
  display: flex;
  align-items: flex-start;
  gap: 1rem;
  margin-bottom: 1rem;
}

.tracking-timeline-dot {
  width: 0.5rem;
  height: 0.5rem;
  margin-top: 0.375rem;
  background-color: #1a1a1a;
  border-radius: 50%;
  flex-shrink: 0;
}

.tracking-timeline-content {
  flex: 1;
}

.tracking-timeline-title {
  font-size: 0.875rem;
  color: #1a1a1a;
  font-weight: 500;
}

.tracking-timeline-time {
  font-size: 0.75rem;
  color: #666666;
  margin-top: 0.125rem;
}

/* Locations */
.tracking-location {
  display: block;
  margin-bottom: 2rem;
}

.tracking-location:last-child {
  margin-bottom: 0;
}

.tracking-location-header {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  margin-bottom: 0.75rem;
}

.tracking-location-badge {
  display: flex;
  align-items: center;
  justify-content: center;
  width: 1.5rem;
  height: 1.5rem;
  border-radius: 50%;
  font-size: 0.75rem;
}

.tracking-location-badge-light {
  background-color: #f0f0f0;
  color: #1a1a1a;
}

.tracking-location-badge-dark {
  background-color: #1a1a1a;
  color: #ffffff;
}

.tracking-location-label {
  font-size: 0.75rem;
  color: #666666;
}

.tracking-location-name {
  font-size: 0.875rem;
  color: #1a1a1a;
  font-weight: 500;
  margin-bottom: 0.25rem;
}

.tracking-location-detail {
  font-size: 0.875rem;
  color: #666666;
  margin-bottom: 0.25rem;
}

/* Details */
.tracking-details {
  display: block;
}

.tracking-detail-row {
  display: flex;
  justify-content: space-between;
  margin-bottom: 0.75rem;
}

.tracking-detail-row-total {
  padding-top: 0.75rem;
  border-top: 1px solid #f0f0f0;
}

.tracking-detail-label {
  font-size: 0.875rem;
  color: #666666;
}

.tracking-detail-value {
  font-size: 0.875rem;
  color: #1a1a1a;
  font-weight: 500;
}

.tracking-detail-label-total {
  font-size: 0.875rem;
  color: #1a1a1a;
  font-weight: 500;
}

.tracking-detail-value-total {
  font-size: 0.875rem;
  color: #1a1a1a;
  font-weight: 500;
}

.tracking-notes {
  margin-top: 1.5rem;
  padding-top: 1.5rem;
  border-top: 1px solid #f0f0f0;
}

.tracking-notes-label {
  font-size: 0.75rem;
  color: #666666;
  margin-bottom: 0.5rem;
}

.tracking-notes-text {
  font-size: 0.875rem;
  color: #333333;
}

/* Driver */
.tracking-driver {
  display: flex;
  align-items: center;
  gap: 1rem;
}

.tracking-driver-avatar {
  width: 3rem;
  height: 3rem;
  background-color: #f0f0f0;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  flex-shrink: 0;
}

.tracking-driver-icon {
  width: 1.5rem;
  height: 1.5rem;
  color: #999999;
}

.tracking-driver-info {
  flex: 1;
  min-width: 0;
}

.tracking-driver-name {
  font-size: 0.875rem;
  color: #1a1a1a;
  font-weight: 500;
}

.tracking-driver-vehicle {
  font-size: 0.75rem;
  color: #666666;
  margin-top: 0.125rem;
}

.tracking-driver-rating {
  display: flex;
  align-items: center;
  gap: 0.25rem;
  margin-top: 0.25rem;
}

.tracking-rating-icon {
  width: 0.75rem;
  height: 0.75rem;
  color: #999999;
}

.tracking-rating-text {
  font-size: 0.75rem;
  color: #666666;
}

/* Help */
.tracking-help {
  text-align: center;
  padding: 2rem 0;
}

.tracking-help-text {
  font-size: 0.75rem;
  color: #999999;
  margin-top: 0.25rem;
}
</style>

<style scoped>
@keyframes spin {
  from { transform: rotate(0deg); }
  to { transform: rotate(360deg); }
}

.animate-spin {
  animation: spin 1s linear infinite;
}
</style>
